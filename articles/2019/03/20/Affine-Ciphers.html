<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Affine Cipher</title>
  <meta name="description" content="A linear cipher like the Hill Cipher isvulnerableto a known plaintext attack: just resolve a set of linearequations and get the secret key.An affine cipher i...">

  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  

  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX","output/HTML-CSS"],
        tex2jax: {inlineMath: [["$$","$$"],["\\(","\\)"]]},
	TeX: {
	  Macros: {
            
	  }
	}
      });
    </script>
    
      <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js' async></script>
    
  

  
    <script
       src="https://code.jquery.com/jquery-3.4.1.min.js"
       integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
       crossorigin="anonymous"></script>
  

  

    
      <script src='https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js' ></script>
    

    
      <script src="https://d3js.org/d3.v4.min.js"></script>
    

    <script src='/book-of-gehn/js/venn/venn.min.js'></script>
    <script src='/book-of-gehn/js/venn/helper.js'></script>

    <script src='/book-of-gehn/js/fix_syntax_highlight.js'></script>
  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/tufte.css">
  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/latex.css">

  <link rel="canonical" href="/book-of-gehn/articles/2019/03/20/Affine-Ciphers.html">

  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/all.min.css">

  <link type="application/atom+xml" rel="alternate" href="/book-of-gehn/feed.xml" title="The Book of Gehn" />
</head>

  <body>
    <header>
	
		<h1 class="header-title"><a href="/book-of-gehn/">The Book of Gehn</a></h1>
		
		
	

    

    
</header>

    <article class="group">
      <h1>Affine Cipher</h1>
<p class="subtitle">March 20, 2019</p>

<p>A <em>linear</em> cipher like the Hill Cipher is
<a href="/book-of-gehn/articles/2019/01/02/Break-Hill-Cipher-with-a-Known-Plaintext-Attack.html">vulnerable</a>
to a known plaintext attack: just resolve a set of linear
equations and get the secret key.</p>

<p>An <em>affine</em> cipher is a little harder to break, however it could
be vulnerable to a <em>differential</em> attack.
<!--more--></p>

<p>Formerly, an <em>affine</em> encryption looks like this</p>

<script type="math/tex; mode=display">A p_i + B = c_i\quad(\textrm{mod } m)</script>

<p>and the decryption like this:</p>

<script type="math/tex; mode=display">p_i = [A]^{-1} (c_i - B)\quad(\textrm{mod } m)</script>

<p>where <script type="math/tex">A</script> and <script type="math/tex">B</script> are secret and unknown to the attacker
but we can assume that have known shapes of <script type="math/tex">n\textrm{x}n</script> and
<script type="math/tex">n\textrm{x}1</script> respectively.</p>

<h2 id="differential-cryptanalysis">Differential cryptanalysis</h2>

<p>Consider the following ciphertext and the partial known plaintext:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">cryptonita</span> <span class="kn">import</span> <span class="n">B</span> <span class="k">as</span> <span class="n">asbytes</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">251</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">asbytes</span><span class="p">(</span><span class="n">b</span><span class="s">'"</span><span class="se">\x93</span><span class="s">&amp;</span><span class="se">\xd3</span><span class="s">)</span><span class="se">\x97\xb0\xa8\xa6\xf1</span><span class="s">7@,f</span><span class="se">\xb2\x17</span><span class="s">LsNs</span><span class="se">\xe0\xd7</span><span class="s">'</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kplaintext</span> <span class="o">=</span> <span class="n">asbytes</span><span class="p">(</span><span class="n">b</span><span class="s">'..fi....ra..fo..at....'</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
</code></pre></div></div>

<p>From there we can take two plaintexts <script type="math/tex">p_i</script> and <script type="math/tex">p_j</script> with their associated
ciphertexts <script type="math/tex">c_i</script> and <script type="math/tex">c_j</script>.</p>

<script type="math/tex; mode=display">A p_i + B = c_i\quad(\textrm{mod } m)</script>

<script type="math/tex; mode=display">A p_j + B = c_j\quad(\textrm{mod } m)</script>

<p>If we <em>substract</em> both equations we obtain a <em>linear</em> system
like the Hill Cipher:</p>

<script type="math/tex; mode=display">A (p_i - p_j) = (c_i - c_j)\quad(\textrm{mod } m)</script>

<p><label for="mn-6e2dec04b8a913bbe537b4514190174b" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-6e2dec04b8a913bbe537b4514190174b" class="margin-toggle" /><span class="marginnote">Keep in mind the affine transformation is a <em>block cipher</em> with blocks
of <script type="math/tex">n</script> bytes.
So the plaintext/ciphertext pairs <strong>must</strong> be <script type="math/tex">n</script>-bytes <em>aligned</em>
(they <strong>must</strong> come from positions multiple of <script type="math/tex">n</script>). </span></p>

<p>In order to break an affine cipher we need <script type="math/tex">2n</script> independent
plaintext-ciphertext pairs (for a linear cipher we need just <script type="math/tex">n</script>)</p>

<p>Here is the first two pairs and the first difference:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">p11</span><span class="p">,</span> <span class="n">c11</span> <span class="o">=</span> <span class="n">kplaintext</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p12</span><span class="p">,</span> <span class="n">c12</span> <span class="o">=</span> <span class="n">kplaintext</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">dp1</span> <span class="o">=</span> <span class="p">(</span><span class="n">p11</span> <span class="o">-</span> <span class="n">p12</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dc1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c11</span> <span class="o">-</span> <span class="n">c12</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span>
</code></pre></div></div>

<p>Here we build the second difference:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">p21</span><span class="p">,</span> <span class="n">c21</span> <span class="o">=</span> <span class="n">kplaintext</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">p22</span><span class="p">,</span> <span class="n">c22</span> <span class="o">=</span> <span class="n">kplaintext</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">ciphertext</span><span class="p">[</span><span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">dp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">p21</span> <span class="o">-</span> <span class="n">p22</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dc2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c21</span> <span class="o">-</span> <span class="n">c22</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span>
</code></pre></div></div>

<p>Stacking all this together we build the difference matrices for
the plaintexts and ciphertexts of shapes <script type="math/tex">n\textrm{x}n</script>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">dP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dp1</span><span class="p">,</span> <span class="n">dp2</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">dc1</span><span class="p">,</span> <span class="n">dc2</span><span class="p">))</span>
</code></pre></div></div>

<p>Remembering that the linear cipher is:</p>

<script type="math/tex; mode=display">A\ dP = dC \quad(\textrm{mod } m)</script>

<p>From here we can obtain <script type="math/tex">A</script>:</p>

<script type="math/tex; mode=display">A = dC\ [dP]^{-1} \quad(\textrm{mod } m)</script>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">cryptonita.mod</span> <span class="kn">import</span> <span class="n">inv_matrix</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">idP</span> <span class="o">=</span> <span class="n">inv_matrix</span><span class="p">(</span><span class="n">dP</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dC</span><span class="p">,</span> <span class="n">idP</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">A</span>
<span class="n">array</span><span class="p">([[</span> <span class="mi">95</span><span class="p">,</span>   <span class="mi">1</span><span class="p">],</span>
       <span class="p">[</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">191</span><span class="p">]])</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">iA</span> <span class="o">=</span> <span class="n">inv_matrix</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">iA</span>
<span class="n">array</span><span class="p">([[</span>  <span class="mi">4</span><span class="p">,</span>  <span class="mi">67</span><span class="p">],</span>
       <span class="p">[</span><span class="mi">123</span><span class="p">,</span> <span class="mi">161</span><span class="p">]])</span>
</code></pre></div></div>

<p>Using one of the plaintext-ciphertext pairs we can obtain
the remaining unknown value: the <script type="math/tex">B</script> vector.</p>

<script type="math/tex; mode=display">B = c - A p \quad(\textrm{mod } m)</script>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">c11</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">p11</span><span class="p">))</span> <span class="o">%</span> <span class="n">m</span>
</code></pre></div></div>

<p>Finally, let’s decrypt the message!</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">cblocks</span> <span class="o">=</span> <span class="n">asbytes</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">)</span><span class="o">.</span><span class="n">nblocks</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pblocks</span> <span class="o">=</span> <span class="p">[]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">cblocks</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">cb</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="o">...</span>     <span class="n">pb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">iA</span><span class="p">,</span> <span class="n">cb</span> <span class="o">-</span> <span class="n">B</span><span class="p">)</span> <span class="o">%</span> <span class="n">m</span>
<span class="o">...</span>     <span class="n">pb</span> <span class="o">=</span> <span class="n">asbytes</span><span class="p">(</span><span class="n">pb</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
<span class="o">...</span>     <span class="n">pblocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pb</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">plaintext</span> <span class="o">=</span> <span class="n">b</span><span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pblocks</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">plaintext</span>
<span class="s">'Affine transformation!'</span>
</code></pre></div></div>



    </article>
    <span class="print-footer">Affine Cipher - March 20, 2019 - Gehn</span>
    <footer>
    <hr class="slender">
    <div class="credits">
        <span>&copy; 2021
            
            Gehn
        </span></br>
            <a style="text-decoration: none;" href="/book-of-gehn/feed.xml"><img height="16px" width="16px" src="/book-of-gehn/assets/blog-assets/rss-32px.png" /></a>
        <br>
        

    
    </div>
</footer>

  </body>
</html>
