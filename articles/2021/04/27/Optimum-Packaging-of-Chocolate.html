<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Optimum Packaging of Chocolate</title>
  <meta name="description" content="A small business sells two types of chocolate packs: A and B.The pack A has 300 grams of bittersweet chocolate, 500 grams ofchocolate with walnuts and 200 gr...">

  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  

  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX","output/HTML-CSS"],
        tex2jax: {inlineMath: [["$$","$$"],["\\(","\\)"]]},
	TeX: {
	  Macros: {
            
	  }
	}
      });
    </script>
    
      <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js' async></script>
    
  

  
    <script
       src="https://code.jquery.com/jquery-3.4.1.min.js"
       integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
       crossorigin="anonymous"></script>
  

  

    
      <script src='https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js' ></script>
    

    
      <script src="https://d3js.org/d3.v4.min.js"></script>
    

    <script src='/book-of-gehn/js/venn/venn.min.js'></script>
    <script src='/book-of-gehn/js/venn/helper.js'></script>

    <script src='/book-of-gehn/js/fix_syntax_highlight.js'></script>
  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/tufte.css">
  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/latex.css">

  <link rel="canonical" href="/book-of-gehn/articles/2021/04/27/Optimum-Packaging-of-Chocolate.html">

  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/all.min.css">

  <link type="application/atom+xml" rel="alternate" href="/book-of-gehn/feed.xml" title="The Book of Gehn" />
</head>

  <body>
    <header>
	
		<h1 class="header-title"><a href="/book-of-gehn/">The Book of Gehn</a></h1>
		
		
	

    

    
</header>

    <article class="group">
      <h1>Optimum Packaging of Chocolate</h1>
<p class="subtitle">April 27, 2021</p>

<p>A small business sells two types of chocolate packs: A and B.</p>

<p>The pack A has 300 grams of bittersweet chocolate, 500 grams of
chocolate with walnuts and 200 grams of white chocolate.</p>

<p>The pack B has 400 grams of bittersweet chocolate, 200 grams of
chocolate with walnuts and 400 grams of white chocolate.</p>

<p>The pack A has a price of 120$ while the pack B has a price of 90$.</p>

<p>Let’s assume that this small business has for today 100 kilograms of
bittersweet chocolate, 120 kilograms of chocolate with walnuts and 100
kilograms of while chocolate.</p>

<p>How many packs of A and B type should be packed to maximize the profits?
<!--more--></p>

<h2 id="of-variables-and-restrictions">Of variables and restrictions</h2>

<p>First, we set up a solver that not only will say if a set of
restrictions are
satisfiable or not but it will also give us an instance (model) that
<em>maximizes</em> a given <em>objective function</em>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">z3</span> <span class="kn">import</span> <span class="n">Reals</span><span class="p">,</span> <span class="n">Optimize</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Optimize</span><span class="p">()</span>
</code></pre></div></div>

<p>Let start defining be the following variables that represent how many packs
of each type we need to make:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a_cnt</span><span class="p">,</span> <span class="n">b_cnt</span> <span class="o">=</span> <span class="n">Reals</span><span class="p">(</span><span class="s">'a_cnt b_cnt'</span><span class="p">)</span>
</code></pre></div></div>

<p>Then, we have the variables that represent how much chocolate we <em>use</em> of
each flavor:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">bittersweet</span><span class="p">,</span> <span class="n">with_walnuts</span><span class="p">,</span> <span class="n">white</span> <span class="o">=</span> <span class="n">Reals</span><span class="p">(</span><span class="s">'bittersweet with_walnuts white'</span><span class="p">)</span>
</code></pre></div></div>

<p>So now we can relate the amount of A and B packs with the amount of
chocolate of each flavor:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="o">...</span>     <span class="mi">300</span> <span class="o">*</span> <span class="n">a_cnt</span> <span class="o">+</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">b_cnt</span> <span class="o">==</span> <span class="n">bittersweet</span><span class="p">,</span>
<span class="o">...</span>     <span class="mi">500</span> <span class="o">*</span> <span class="n">a_cnt</span> <span class="o">+</span> <span class="mi">200</span> <span class="o">*</span> <span class="n">b_cnt</span> <span class="o">==</span> <span class="n">with_walnuts</span><span class="p">,</span>
<span class="o">...</span>     <span class="mi">200</span> <span class="o">*</span> <span class="n">a_cnt</span> <span class="o">+</span> <span class="mi">400</span> <span class="o">*</span> <span class="n">b_cnt</span> <span class="o">==</span> <span class="n">white</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div></div>

<p>But the amount of chocolate is limited:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">bittersweet</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">with_walnuts</span> <span class="o">&lt;=</span> <span class="mi">120</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">white</span> <span class="o">&lt;=</span> <span class="mi">100</span><span class="o">*</span><span class="mi">1000</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div></div>

<p>And technically, the amount of packs has also a lower bound</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">a_cnt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">b_cnt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">bittersweet</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">with_walnuts</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">white</span> <span class="o">&gt;=</span> <span class="mi">0</span>
<span class="o">...</span> <span class="p">)</span>
</code></pre></div></div>

<p><label for="mn-e443e681f28524ed57a685ba1b5097eb" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-e443e681f28524ed57a685ba1b5097eb" class="margin-toggle" /><span class="marginnote">In Python <code class="highlighter-rouge">a &lt;= b &lt;= c</code> is a valid expression but in Z3 it is not
and you need to define two separated statements <code class="highlighter-rouge">a &lt;= b</code> and <code class="highlighter-rouge">b &lt;= c</code>.
 </span></p>

<h2 id="the-objective">The objective</h2>

<p>And finally, this is the <em>linear</em> function that we want to maximize:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">objective</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">maximize</span><span class="p">(</span><span class="mi">120</span> <span class="o">*</span> <span class="n">a_cnt</span> <span class="o">+</span> <span class="mi">90</span> <span class="o">*</span> <span class="n">b_cnt</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
<span class="n">sat</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">objective</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
<span class="mi">33000</span>
</code></pre></div></div>

<p>So the optimal income will be 33000$ and the amount of packs and
chocolate is:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
<span class="p">[</span><span class="n">b_cnt</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
 <span class="n">a_cnt</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
 <span class="n">white</span> <span class="o">=</span> <span class="mi">80000</span><span class="p">,</span>
 <span class="n">with_walnuts</span> <span class="o">=</span> <span class="mi">120000</span><span class="p">,</span>
 <span class="n">bittersweet</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">]</span>
</code></pre></div></div>

<p>As expected the optimal solution is when we use most of the chocolate.</p>

<h3 id="slack">Slack</h3>

<p>The only one that had some <em>slack</em> was white chocolate. Having a limit
of 100 kilograms, the optimal solution required 80 kilograms with 20
kilograms without use.</p>

<p>We can let Z3 to calculate that for use redefining the inequalities by
introducing <em>slack variables</em> and making them equalities:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">bittersweet_slack</span><span class="p">,</span> <span class="n">with_walnuts_slack</span><span class="p">,</span> <span class="n">white_slack</span> <span class="o">=</span> <span class="n">Reals</span><span class="p">(</span><span class="s">'bittersweet_slack with_walnuts_slack white_slack'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
<span class="o">...</span>     <span class="n">bittersweet_slack</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">with_walnuts_slack</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">white_slack</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">bittersweet</span> <span class="o">+</span> <span class="n">bittersweet_slack</span> <span class="o">==</span> <span class="mi">100</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">with_walnuts</span> <span class="o">+</span> <span class="n">with_walnuts_slack</span> <span class="o">==</span> <span class="mi">120</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span>
<span class="o">...</span>     <span class="n">white</span> <span class="o">+</span> <span class="n">white_slack</span> <span class="o">==</span> <span class="mi">100</span><span class="o">*</span><span class="mi">1000</span>
<span class="o">...</span> <span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">check</span><span class="p">()</span>
<span class="n">sat</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="o">.</span><span class="n">model</span><span class="p">()</span>
<span class="p">[</span><span class="n">b_cnt</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
 <span class="n">a_cnt</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
 <span class="n">white_slack</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>
 <span class="n">with_walnuts_slack</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
 <span class="n">bittersweet_slack</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
 <span class="n">white</span> <span class="o">=</span> <span class="mi">80000</span><span class="p">,</span>
 <span class="n">with_walnuts</span> <span class="o">=</span> <span class="mi">120000</span><span class="p">,</span>
 <span class="n">bittersweet</span> <span class="o">=</span> <span class="mi">100000</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="assumptions">Assumptions</h2>

<p><label for="mn-021db9f39d0b1ca9edb96ffb431eecca" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-021db9f39d0b1ca9edb96ffb431eecca" class="margin-toggle" /><span class="marginnote">Precise values; linear, proportional and additivity relations; and
variables in <script type="math/tex">\mathbb{R}</script>
 </span></p>

<p>When we say “the pack A has 300 grams of bittersweet chocolate” we are
incurring in a huge assumption: that the number 300 is a real and
<em>precise</em> thing.</p>

<p>In the real world is hard or even impossible to operate with precise
quantities. Think that the manufacturing process has some
inefficiencies, the balance/scale used to measure has not infinite
precision and things like that.</p>

<p>We also said without much thinking that inputs and
outputs are <em>proportional</em>: if the outcome of selling 1 pack A is 120$,
selling 10 packs we should earn 1200$.</p>

<p>We said that we wanted to maximize <code class="highlighter-rouge">120 * a_cnt + 90 * b_cnt</code>. Under the
hood we are also making the assumption that we can <em>sell</em> packs A and
packs B independently and then <em>add them</em> together.</p>

<p>This and the <em>proportional</em> assumptions are required for <strong>linear</strong>
programming.</p>

<p>A cleaver reader may noticed that I used Z3’s <code class="highlighter-rouge">Reals</code> for creating the
variables <code class="highlighter-rouge">a_cnt</code> and <code class="highlighter-rouge">b_cnt</code>. It is obviously wrong because the amount
of packs is an <strong>integer</strong> and not a real number.</p>

<p>We’ve got an integer solution of <code class="highlighter-rouge">a_cnt = 200</code> and <code class="highlighter-rouge">b_cnt = 100</code> but
this was pure luck.</p>

<p>But the same objection can be done for the amount of chocolate: absurd
tiny amounts like 0.0001 grams of chocolate makes no sense.</p>

<p>We assumed that all the variables here have the <em>divisibility</em> property:
they can be modeled as real numbers – that’s why call it <strong>real</strong> linear
programming in opposition to the <strong>integer</strong> linear programming.</p>

<p>The former can be solved in polinomial time. while the
latter is NP-complete.</p>

<p>Z3 uses the <a href="https://en.wikipedia.org/wiki/Simplex_algorithm">Simplex
algorithm</a> which has
exponential time in the worst case but polinomial time in the practice.
Other solvers can do it better and it had been proved that when we use
real numbers the algorithm has polinomial time, like the ones based on
<a href="https://en.wikipedia.org/wiki/Interior-point_method">the interior-point method</a>.</p>



    </article>
    <span class="print-footer">Optimum Packaging of Chocolate - April 27, 2021 - Gehn</span>
    <footer>
    <hr class="slender">
    <div class="credits">
        <span>&copy; 2021
            
            Gehn
        </span></br>
            <a style="text-decoration: none;" href="/book-of-gehn/feed.xml"><img height="16px" width="16px" src="/book-of-gehn/assets/blog-assets/rss-32px.png" /></a>
        <br>
        

    
    </div>
</footer>

  </body>
</html>
