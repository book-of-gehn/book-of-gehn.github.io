<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>The Book of Gehn</title>
  <meta name="description" content="">

  
    <link href='//fonts.googleapis.com/css?family=Lato:400,400italic' rel='stylesheet' type='text/css'>
  

  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX","output/HTML-CSS"],
        tex2jax: {inlineMath: [["$$","$$"],["\\(","\\)"]]},
	TeX: {
	  Macros: {
            
	  }
	}
      });
    </script>
    
      <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js' async></script>
    
  

  
    <script
       src="https://code.jquery.com/jquery-3.4.1.min.js"
       integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
       crossorigin="anonymous"></script>
  

  

    
      <script src='https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js' ></script>
    

    
      <script src="https://d3js.org/d3.v4.min.js"></script>
    

    <script src='/book-of-gehn/js/venn/venn.min.js'></script>
    <script src='/book-of-gehn/js/venn/helper.js'></script>

    <script src='/book-of-gehn/js/fix_syntax_highlight.js'></script>
  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/tufte.css">
  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/latex.css">

  <link rel="canonical" href="/book-of-gehn/">

  <link rel="stylesheet" type="text/css" href="/book-of-gehn/css/all.min.css">

  <link type="application/atom+xml" rel="alternate" href="/book-of-gehn/feed.xml" title="The Book of Gehn" />
</head>

  <body>
    <header>
	
		<h1 class="header-title"><a href="/book-of-gehn/">The Book of Gehn</a></h1>
		
		
	

    

    
</header>

    <article class="group">
      <h1></h1>
<p class="subtitle"></p>

    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/06/05/Seaborn-Cheatsheet.html"><h2 class="larger">Seaborn Cheatsheet</h2></a>
          <br><span class="smaller">June 5, 2021</span>  <br/>
          <div><p>Plotting data was always for me a weak point: it always took me a lot of
time to make the plots and graphs, reading the documentation, <em>googling</em>
how to do one particular tweak and things like that.</p>

<p>So I challenge myself: could I build a <em>cheatsheet</em> about plotting?</p>

<p>Yes, yes I could.</p>

<figure><figcaption><span></span></figcaption><img src="/book-of-gehn/assets/statistics/seaborn-cheatsheet/seaborn-cheatsheet.svg" /></figure>

<p><a href="https://seaborn.pydata.org/">Seaborn</a> is a very simple but powerful
plotting library on top of <a href="https://matplotlib.org/">matplotlib</a> designed
for statistical analysis.</p>

<p>Quick links:
<a href="/book-of-gehn/assets/statistics/seaborn-cheatsheet/seaborn-cheatsheet.pdf">PDF (no bg)</a>,
<a href="/book-of-gehn/assets/statistics/seaborn-cheatsheet/seaborn-cheatsheet-bg.pdf">PDF (bg)</a>,
<a href="/book-of-gehn/assets/statistics/seaborn-cheatsheet/seaborn-cheatsheet.svg">SVG (no bg)</a>,
<a href="/book-of-gehn/assets/statistics/seaborn-cheatsheet/seaborn-cheatsheet-bg.svg">SVG (bg)</a>
.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/05/26/Casting-Broadcasting-LUT-and-Bitwise-Ops.html"><h2 class="larger">Casting, broadcasting, LUT and bitwise ops</h2></a>
          <br><span class="smaller">May 26, 2021</span>  <br/>
          <div><p>Z3 has a few basic symbolic operation over bit vectors.</p>

<p>But some others are missing (or at least I couldn’t find them).</p>

<p><em>Cast</em> bit vectors to change the vector width, like when you want to
<em>upcast</em> or <em>promote</em> a <code class="highlighter-rouge">uint8_t</code> to <code class="highlighter-rouge">uint16_t</code>, is one of them.</p>

<p>Arbitrary <em>bitwise operations</em> is another one. Z3 provides the basic
<code class="highlighter-rouge">And</code>, <code class="highlighter-rouge">Or</code> and <code class="highlighter-rouge">Xor</code> but arbitrary functions needs to be defined and
applied by hand.</p>

<p>And about function definitions, Z3 does not have a simple way to <em>define
a function from a lookup table (LUT) or truth table</em>.</p>

<blockquote>
  <p><em>A much tricker that I thought!</em></p>
</blockquote>

<p>This post is a kind-of sequel of
<a href="/book-of-gehn/articles/2021/05/17/Verifying-Some-Bithacks.html">Verifying some Bithacks post</a>
and prequel of some future posts.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/05/17/Verifying-Some-Bithacks.html"><h2 class="larger">Verifying some bithacks</h2></a>
          <br><span class="smaller">May 17, 2021</span>  <br/>
          <div><p>We are going to verify some of the <a href="https://graphics.stanford.edu/~seander/bithacks.html">bit twiddling
hacks</a> made and
collected by Sean Eron Anderson and other authors.</p>

<p>This is <em>the</em> classical scenario to put on test your Z3 skills.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/05/09/Solving-a-Murder-Case-with-Z3.html"><h2 class="larger">Solving a Murder Case with Z3</h2></a>
          <br><span class="smaller">May 9, 2021</span>  <br/>
          <div><p>Victor has been murdered!</p>

<p>There are strong evidences that point that Victor was murdered by
a single person. The investigation led to three suspects:
Art, Bob, and Carl.</p>

<p>But who is the murder?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/05/02/Planning-Space-Missions.html"><h2 class="larger">Planning Space Missions with Z3</h2></a>
          <br><span class="smaller">May 2, 2021</span>  <br/>
          <div><p>A space company is planning the next 4 years. It has several projects,
each one with its own budget requirement per year, but the company has a
limited budget to invest.</p>

<p>Moreover, some projects <em>depends</em> on others to make them feasible and
some projects <em>cannot be done</em> if other projects due unbreakable restrictions.</p>

<table>
  <thead>
    <tr>
      <th>Project</th>
      <th>1st</th>
      <th>2nd</th>
      <th>3rd</th>
      <th>4th</th>
      <th>Depends</th>
      <th>Not</th>
      <th>Profit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1 Cube-1 nano-sat</td>
      <td>1.1</td>
      <td>2</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>12</td>
    </tr>
    <tr>
      <td>2 Cube-2 nano-sat</td>
      <td> </td>
      <td>2.5</td>
      <td>2</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>12</td>
    </tr>
    <tr>
      <td>3 Infrared sat</td>
      <td> </td>
      <td> </td>
      <td>1</td>
      <td>4.1</td>
      <td>on 6</td>
      <td>with 4</td>
      <td>18</td>
    </tr>
    <tr>
      <td>4 Colored img sat</td>
      <td> </td>
      <td> </td>
      <td>2</td>
      <td>8</td>
      <td> </td>
      <td>with 3</td>
      <td>15</td>
    </tr>
    <tr>
      <td>5 Mars probe</td>
      <td> </td>
      <td>2</td>
      <td>8</td>
      <td>4.4</td>
      <td>on 1 &amp; 2</td>
      <td> </td>
      <td>12</td>
    </tr>
    <tr>
      <td>6 Microwave tech</td>
      <td>4</td>
      <td>2.3</td>
      <td>2</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td>1</td>
    </tr>
  </tbody>
</table>

<p>Under an incredible amount of assumptions and good luck, what is the
best strategy to maximize the profit?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/04/29/Blending-Whisky.html"><h2 class="larger">Blending Whisky with Z3</h2></a>
          <br><span class="smaller">April 29, 2021</span>  <br/>
          <div><p>A whisky producer uses three kind of licor to make their whisky: <script type="math/tex">A</script>,
<script type="math/tex">B</script> and <script type="math/tex">C</script>.</p>

<p>Three kind of whisky can be made using the licor
in the following proportions:</p>

<table>
  <thead>
    <tr>
      <th>Whisky</th>
      <th>Sales Price</th>
      <th>Recipe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><script type="math/tex">E</script></td>
      <td><script type="math/tex">680</script></td>
      <td>No less than 60% of <script type="math/tex">A</script>, no more than 20% of <script type="math/tex">C</script></td>
    </tr>
    <tr>
      <td><script type="math/tex">F</script></td>
      <td><script type="math/tex">570</script></td>
      <td>No less than 15% of <script type="math/tex">A</script>, no more than 80% of <script type="math/tex">C</script></td>
    </tr>
    <tr>
      <td><script type="math/tex">G</script></td>
      <td><script type="math/tex">450</script></td>
      <td>No more than 50% of <script type="math/tex">C</script></td>
    </tr>
  </tbody>
</table>

<p>The producer has the following stock and price list from its licor supplier:</p>

<table>
  <thead>
    <tr>
      <th>Licor</th>
      <th>Stock</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><script type="math/tex">A</script></td>
      <td><script type="math/tex">2000</script></td>
      <td><script type="math/tex">700</script></td>
    </tr>
    <tr>
      <td><script type="math/tex">B</script></td>
      <td><script type="math/tex">2500</script></td>
      <td><script type="math/tex">500</script></td>
    </tr>
    <tr>
      <td><script type="math/tex">C</script></td>
      <td><script type="math/tex">1200</script></td>
      <td><script type="math/tex">400</script></td>
    </tr>
  </tbody>
</table>

<p>Note: the prices are in $ per liter and the stock are in liters.</p>

<p>The goal is to maximize the profit.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/04/27/Optimum-Packaging-of-Chocolate.html"><h2 class="larger">Optimum Packaging of Chocolate</h2></a>
          <br><span class="smaller">April 27, 2021</span>  <br/>
          <div><p>A small business sells two types of chocolate packs: A and B.</p>

<p>The pack A has 300 grams of bittersweet chocolate, 500 grams of
chocolate with walnuts and 200 grams of white chocolate.</p>

<p>The pack B has 400 grams of bittersweet chocolate, 200 grams of
chocolate with walnuts and 400 grams of white chocolate.</p>

<p>The pack A has a price of 120$ while the pack B has a price of 90$.</p>

<p>Let’s assume that this small business has for today 100 kilograms of
bittersweet chocolate, 120 kilograms of chocolate with walnuts and 100
kilograms of while chocolate.</p>

<p>How many packs of A and B type should be packed to maximize the profits?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/04/25/Congruence-Closure.html"><h2 class="larger">Congruence Closure with Z3</h2></a>
          <br><span class="smaller">April 25, 2021</span>  <br/>
          <div><p>Assume that you know that <script type="math/tex">a = b</script>, <script type="math/tex">b = c</script> and <script type="math/tex">d = e</script>. What can you
tell me about the claim <script type="math/tex">a = c</script> ? Is it true or false?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/04/24/Deadly-Typos-2020.html"><h2 class="larger">Deadly Typos 2020</h2></a>
          <br><span class="smaller">April 24, 2021</span>  <br/>
          <div><p>A quick summary of the top 3 <em>typos</em> that I found (or I wrote) in code
that they were small but they had a deep impact on the functionality.</p>

<p>In fact, the three bugs could summarized as follows:</p>

<ul>
  <li>a missing <code class="highlighter-rouge">u</code>.</li>
  <li>an extra <code class="highlighter-rouge">s</code>.</li>
  <li>and a missing <code class="highlighter-rouge">*</code>.</li>
</ul>

<p>Do you want to see what is this about?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/03/07/Quiescent-Environment.html"><h2 class="larger">Quiescent Environment</h2></a>
          <br><span class="smaller">March 7, 2021</span>  <br/>
          <div><p>You are working in optimizing a piece of software to reduce
the CPU cycles that it takes.</p>

<p>To compare your improvements, it is reasonable to measure the elapsed
time before and after your change.</p>

<p>Unless you are using a simulator, it is impossible to run a program
<em>isolated</em> from the rest and your measurements will be noisy.</p>

<p>If you want to take precise measurements you need a <em>quiescent</em>
environment as much as possible.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/02/27/High-Precision-Timers.html"><h2 class="larger">High Precision Timers (userspace)</h2></a>
          <br><span class="smaller">February 27, 2021</span>  <br/>
          <div><p>You want to measure the time that it takes <code class="highlighter-rouge">foo()</code> to run so
you do the following:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">experiment</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">uint64_t</span> <span class="n">begin</span> <span class="o">=</span> <span class="n">now</span><span class="p">();</span>
    <span class="n">foo</span><span class="p">();</span>
    <span class="kt">uint64_t</span> <span class="n">end</span> <span class="o">=</span> <span class="n">now</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s">"Elapsed: %lu</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">begin</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The question is, what <code class="highlighter-rouge">now()</code> function you would use?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/02/18/Ksplice-Pointer-Challenge.html"><h2 class="larger">Ksplice-Pointer-Challenge</h2></a>
          <br><span class="smaller">February 18, 2021</span>  <br/>
          <div><p>What does the following code?</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;stdio.h&gt;
</span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kt">int</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"%p</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/02/15/Necklaces-Lyndon-Words-and-De-Bruijn-Sequences.html"><h2 class="larger">Necklaces, Lyndon words and De Bruijn Sequences</h2></a>
          <br><span class="smaller">February 15, 2021</span>  <br/>
          <div><p>What have in common a dense arrays for mapping numbers power of 2
to some objects, DNA sequencing and brute-forcing the lock pad
of your neighbor?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/02/04/Smashing-ARM-Stack-for-Fun-Part-VII.html"><h2 class="larger">Smashing ARM Stack for Fun - Part VII</h2></a>
          <br><span class="smaller">February 4, 2021</span>  <br/>
          <div><p>It’s time to solve the last challenge of this 7 part serie.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/26/Smashing-ARM-Stack-for-Fun-Part-VI.html"><h2 class="larger">Smashing ARM Stack for Fun - Part VI</h2></a>
          <br><span class="smaller">January 26, 2021</span>  <br/>
          <div><p>We have the same vulnerability than we have in
<a href="/book-of-gehn/articles/2021/01/14/Smashing-ARM-Stack-for-Fun-Part-V.html">stack4</a>
but this time we will make our own egg/shellcode.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/20/Smashing-ARM-Stack-for-Fun-Part-V.html"><h2 class="larger">Smashing ARM Stack for Fun - Part V</h2></a>
          <br><span class="smaller">January 20, 2021</span>  <br/>
          <div><p><a href="https://github.com/azeria-labs/ARM-challenges">Fifth challenge</a>
with a small introduction to <em>process continuation</em>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/19/Smashing-ARM-Stack-for-Fun-Part-IV.html"><h2 class="larger">Smashing ARM Stack for Fun - Part IV</h2></a>
          <br><span class="smaller">January 19, 2021</span>  <br/>
          <div><p>This time the goal is to make the program print the message
<code class="highlighter-rouge">"code flow successfully changed"</code>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/18/Smashing-ARM-Stack-for-Fun-Part-III.html"><h2 class="larger">Smashing ARM Stack for Fun - Part III</h2></a>
          <br><span class="smaller">January 18, 2021</span>  <br/>
          <div><p>Another fast moving post
about exploiting the <a href="https://github.com/azeria-labs/ARM-challenges">third Arm challenge</a></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/17/Smashing-ARM-Stack-for-Fun-Part-II.html"><h2 class="larger">Smashing ARM Stack for Fun - Part II</h2></a>
          <br><span class="smaller">January 17, 2021</span>  <br/>
          <div><p>This is going to be a fast moving post, directly to the details,
about exploiting the <a href="https://github.com/azeria-labs/ARM-challenges">second Arm challenge</a></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/14/Smashing-ARM-Stack-for-Fun-Part-I.html"><h2 class="larger">Smashing ARM Stack for Fun - Part I</h2></a>
          <br><span class="smaller">January 14, 2021</span>  <br/>
          <div><p>This is the first of a serie of posts about exploiting 32 bits Arm
binaries.</p>

<p>These <a href="https://github.com/azeria-labs/ARM-challenges">challenges</a> were
<a href="https://azeria-labs.com/part-3-stack-overflow-challenges/">taken</a>
from <a href="https://azeria-labs.com">Azeria Labs</a>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/09/Interactive-Assembler.html"><h2 class="larger">iasm: Interactive Assembler</h2></a>
          <br><span class="smaller">January 9, 2021</span>  <br/>
          <div><p>I crossed with a series of <a href="https://github.com/azeria-labs/ARM-challenges">Arm challenges</a>
by causality and I decided to give it a shoot.</p>

<p>But I have <strong>0</strong> knowledge about Arm so the disassembly of the binaries
were too strange for me.</p>

<p>I stepped back to plan it better: my idea was to use GDB to debug small snippets of Arm
code, learn about it before jumping into the challenges.</p>

<p>I setup a <a href="/book-of-gehn/articles/2020/12/15/Qemulating-Rasbian-ARM.html">QEMU virtual machine</a>
running Rasbian in an Arm CPU.</p>

<p>With a GCC and GDB running there I started but the compile-load-debug
cycle was too inflexible.</p>

<p>I could not use it to <em>explore</em>.</p>

<p>If I wanted to see the effect of a particular instruction I needed to write
it in assembly, compile it and debug it.</p>

<p>And the time between the “what does X?” and the “X does this” was too
large, reducing the <em>momentum</em> that you have when you explore something
new.</p>

<p>Too tedious.</p>

<p>So I decided to shorten the cycle writing an
<a href="https://github.com/bad-address/iasm"><em>interactive</em> assembler</a>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2021/01/04/Review-Arm-Assembly.html"><h2 class="larger">Review Arm Assembly</h2></a>
          <br><span class="smaller">January 4, 2021</span>  <br/>
          <div><p>There is no other way to learn something that playing with it.</p>

<p>Take assembly code, read it and predice what will do. Then test it.</p>

<p>Those mistakes, those mismatches between what you think and what it
really is, those <em>surprises</em> are what move us forward into learning. Deeper.</p>

<p>In this post I will dig into Arm, assisted with an
<a href="https://github.com/bad-address/iasm">interactive assembler</a>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/12/27/TLDR-Quick-Overview-of-Arm.html"><h2 class="larger">TL;DR Quick Overview of Arm</h2></a>
          <br><span class="smaller">December 27, 2020</span>  <br/>
          <div><p>Speed-reading of
<a href="https://www.coranac.com/tonc/text/asm.htm">Whirlwind Tour of ARM Assembly</a>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/12/15/Qemulating-Rasbian-ARM.html"><h2 class="larger">QEMUlating a Rasbian (ARM)</h2></a>
          <br><span class="smaller">December 15, 2020</span>  <br/>
          <div><p>Quick how-to download and run a Raspbian Buster (ARM) emulating
the vm with QEMU.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/12/05/Self-Licensing.html"><h2 class="larger">Self-Licensing</h2></a>
          <br><span class="smaller">December 5, 2020</span>  <br/>
          <div><figure><figcaption><span></span></figcaption><img class="in-index-only" style="max-width:60%;" alt="self-licensing" src="/book-of-gehn/assets/self-licensing/self-licensing-small.png" /></figure>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/11/29/RC-on-XDP-RX-Queue.html"><h2 class="larger">RC-on-XDP-RX-Queue</h2></a>
          <br><span class="smaller">November 29, 2020</span>  <br/>
          <div><p><label for="mf-482d5a7a07746c31570f73c75afe4260" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-482d5a7a07746c31570f73c75afe4260" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img style="max-width:120%;" alt="RC on RX queue" src="/book-of-gehn/assets/xdp-rx-rc/rx-rc-queues.png" />  <br /></span></p>

<p>Picture this: you’d been developing for six months a network sniffer
using XDP, a kernel <em>in-pass</em> in Linux.</p>

<p>Six months and when you are about to release it, you find not one but
three bugs that shake all your understanding of XDP.</p>

<p>A debugging race against the clock begins.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/11/19/Qubes-Networking.html"><h2 class="larger">Qubes OS Networking</h2></a>
          <br><span class="smaller">November 19, 2020</span>  <br/>
          <div><p><a href="https://www.qubes-os.org/">Qubes OS</a> has an interesting network system
to isolate more-or-less
trusted <em>application</em> virtual machines (App) from absolute untrusted
<em>network</em> VMs (Net).</p>

<p><label for="mf-892e94a4ec9e032aabff049c1567de9b" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-892e94a4ec9e032aabff049c1567de9b" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img style="" class="fullwidth" alt="IPs" src="/book-of-gehn/assets/qubes/qubes-ips.png" />  <br /></span></p>

<p>These last ones have the drivers required to handle ethernet and wifi cards
which expose them to a potentially deathly bug lurking in the drivers.</p>

<p>An additional VM is put in the middle between App VMs and Net VMs. This
absolute trusted <em>proxy</em> VM serves as a safe firewall (Proxy).</p>

<p>In this post will explore how these VMs connect and how the packets are
forwarded up and down along this chain of VMs.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/11/12/TLDR-Stylometrics.html"><h2 class="larger">TL;DR Stylometrics</h2></a>
          <br><span class="smaller">November 12, 2020</span>  <br/>
          <div><p>A ghost writer is a person that writes a document, essay or paper but
the work is presented by other person who <em>claims</em> to be the author.</p>

<p><a href="https://thebestschools.org/resources/detecting-deterring-ghostwritten-papers-best-practices/">Detecting deterring ghostwritten papers</a>
is an article written by a (ex)ghost writer and explains what happens
behind the scene when a student pays for this <em>dark</em> service.</p>

<p>Would be possible to detect this in an automated way?</p>

<p>Given a set of documents, could we determine of they were written or not
by the person or people who claim to be the authors?</p>

<p>This problem is known as <em>authorship attribution</em> and I will show a few
papers that I read about this, in particular around the concept of
<em>stylometric</em>, fingerprints that the real author leaves when he or she
writes.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/10/11/Kasiski-Test-Part-I.html"><h2 class="larger">Kasiski Test - Part I</h2></a>
          <br><span class="smaller">October 11, 2020</span>  <br/>
          <div><p>The tricky part of breaking the
<a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenere cipher</a>
consists in finding the length of the key.</p>

<p><label for="mf-d8d9b4cce50aee3ec67346ab92c66548" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-d8d9b4cce50aee3ec67346ab92c66548" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img src="/book-of-gehn/assets/kasiski/kasiski_scan_positions.png" />  <br /></span></p>

<p>We discussed this in the
<a href="/book-of-gehn/articles/2018/05/01/Breaking-Vigenere.html">breaking Vigenere</a>
post.</p>

<p>In that occasion we used the
<a href="https://en.wikipedia.org/wiki/Hamming_distance">Hamming distance</a> and
the <a href="/book-of-gehn/articles/2019/10/04/Index-of-Coincidence.html">Index of Coincidence</a>.</p>

<p>But another method existed much before the development of the IC around 1922.</p>

<p>In 1863, Kasiski published a method to guess the length of the secret
key, method that we know today as the
<a href="https://en.wikipedia.org/wiki/Kasiski_examination">Kasiski test</a>.</p>

<p>Let’s explore a <script type="math/tex">O(\vert s \vert)</script> solution with a worst case of
<script type="math/tex">O(\vert s \vert^2)</script></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/09/13/Debug-the-Case-of-a-CPU-Burning-Ruby-Process.html"><h2 class="larger">Debug: the Case of a CPU Burning Ruby Process</h2></a>
          <br><span class="smaller">September 13, 2020</span>  <br/>
          <div><p><code class="highlighter-rouge">executor.rb</code> is a little program that starts and finishes other programs
based on the needs of the system.</p>

<p>It is expected to have one and only one <code class="highlighter-rouge">executor.rb</code> process running with
little overhead.</p>

<p>In one of the machines in the lab I found the opposite: two <code class="highlighter-rouge">executor.rb</code>
instances and one of them running at top speed, consuming 100% of CPU.</p>

<p>For the rest, the system was working properly so one of
the <code class="highlighter-rouge">executor.rb</code> was doing its job.</p>

<p>But what was the <em>“twin evil”</em> process doing with the CPU?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/09/09/Reds-and-Blues-Architecture.html"><h2 class="larger">Reds and Blues Architecture</h2></a>
          <br><span class="smaller">September 9, 2020</span>  <br/>
          <div><p><label for="mf-c517aba0e777644668f87b82062240e3" class="margin-toggle  ">⊕</label><input type="checkbox" id="mf-c517aba0e777644668f87b82062240e3" class="margin-toggle  " /><span class="marginnote  "><img style="max-width: 100%;" class="fullwidth" alt="" src="/book-of-gehn/assets/design/reds-and-blues-original.png" />  <br />Original design: a little messy with IO mixed with CPU bounded code.</span></p>

<p>Could we design an architecture that allows us to have insight about the
performance of the system?</p>

<p>When you spend nights debugging searching where is the bottleneck, it is
when you blame the you of the past for a so <em>opaque</em> and slow architecture.</p>

<p>This is the proposal of a simple architecture that allows
introspection and enables – too many times forgotten – basic
optimizations.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/05/16/Debugging-Lock-Free-Algorithms.html"><h2 class="larger">Debugging Lock Free Algorithms</h2></a>
          <br><span class="smaller">May 16, 2020</span>  <br/>
          <div><p>Debugging multithread code is hard and lock free algorithms
is harder.</p>

<p>What cleaver tricks can we use?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/04/28/Lock-Free-Queue-Part-II.html"><h2 class="larger">Lock Free Queue - Part II</h2></a>
          <br><span class="smaller">April 28, 2020</span>  <br/>
          <div><p>If implementing a lock-free queue for only one producer and consumer
is tricky, adding more producers and consumers moves this
to the next level.</p>

<p>This is the continuation of the
<a href="/book-of-gehn/articles/2020/03/22/Lock-Free-Queue-Part-I.html">lock-free single-producer single-consumer queue</a></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/04/19/Sidenote-Identifiers.html"><h2 class="larger">Sidenote: Identifiers</h2></a>
          <br><span class="smaller">April 19, 2020</span>  <br/>
          <div><p>What would be a nice identifier for the people in, let’s say, a database?</p>

<figure><figcaption><span></span></figcaption><img style="max-width: 70%;" src="/book-of-gehn/assets/2020-04-19-Sidenote-Identifiers/email.png" /></figure>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/03/22/Lock-Free-Queue-Part-I.html"><h2 class="larger">Lock-Free Queue - Part I</h2></a>
          <br><span class="smaller">March 22, 2020</span>  <br/>
          <div><p>While implementing a bounded queue or <em>ring buffer</em> in a single-thread
universe is relatively easy, doing the same when you have
two threads, the implementation of a lock-free queue
is <em>more challenging</em>.</p>

<figure><figcaption><span></span></figcaption><img style="" src="/book-of-gehn/assets/mpmc-queue/queue-sp-sc.png" /></figure>

<p>In this first part will analyse and implement a lock-free single-producer
single-consumer queue. A multi-producer multi-consumer queue is
described in the
<a href="/book-of-gehn/articles/2020/04/28/Lock-Free-Queue-Part-II.html">second part</a>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/02/15/CPU-Cache-Coherence.html"><h2 class="larger">Effects of CPU Cache Coherence</h2></a>
          <br><span class="smaller">February 15, 2020</span>  <br/>
          <div><p><label for="mf-60ce1018c40b8a23f191ac0831675972" class="margin-toggle  ">⊕</label><input type="checkbox" id="mf-60ce1018c40b8a23f191ac0831675972" class="margin-toggle  " /><span class="marginnote  "><img style="" class="fullwidth" alt="" src="/book-of-gehn/assets/memory/rc/cnt-cpu-2ndcpu-heatmap.png" />  <br /></span></p>

<p>Most modern cpus see a single <em>shared</em> main memory seeing
the same thing, <em>eventually</em>.</p>

<p>This post explores what is
behind this <em>“eventually”</em> term.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2020/02/07/Compiler-Optimizations-under-RC.html"><h2 class="larger">Compiler Optimizations under a Race Condition</h2></a>
          <br><span class="smaller">February 7, 2020</span>  <br/>
          <div><p><label for="mf-7fbb50af557f9e5155904b080e9c6d7f" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-7fbb50af557f9e5155904b080e9c6d7f" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img style="" class="fullwidth" alt="" src="/book-of-gehn/assets/memory/rc/rcO0-busy-loop.png" />  <br /></span></p>

<p>When two or more concurrent tasks perform non-atomic read/write operations
over the same data we have a <em>race condition</em> and
the system will be in an undefined state.</p>

<p>But what exactly does that suppose to mean? What is behind the
generic <em>undefined state</em>?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/10/27/Writeup-EKO2019-RPG-Part-I-Reversing.html"><h2 class="larger">RPG - Part I (IDA writeup - EKO 2019)</h2></a>
          <br><span class="smaller">October 27, 2019</span>  <br/>
          <div><p><code class="highlighter-rouge">rpg</code> is a buggy game where the player can attack to
and defend from attacks of monsters.</p>

<p>Let’s see if we can know how it works.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/10/23/Constant-Rate-Loop.html"><h2 class="larger">Constant Rate Loop</h2></a>
          <br><span class="smaller">October 23, 2019</span>  <br/>
          <div><p><label for="mf-e1406f7dc5c4cd4de5628db455ab7473" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-e1406f7dc5c4cd4de5628db455ab7473" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img style="" class="fullwidth" alt="Bite" src="/book-of-gehn/assets/distributing/constant_rate/examples/bite.gif" />  <br />Same animation that last 1 second in a loop. From top to down, the first
is an animation without any frame lost, the second had lost some frames
but <code class="highlighter-rouge">draw()</code> is still in sync, the last one lost the same amount
of frames but <code class="highlighter-rouge">draw()</code> used its own notion of time an got out of sync.
 <a href="https://github.com/eldipa/book-of-gehn/blob/master/assets/distributing/constant_rate/examples/drop_iterations.py"><i class="fab fa-github"></i> code</a></span></p>

<figure><figcaption><span></span></figcaption><img style="" src="/book-of-gehn/assets/distributing/constant_rate/examples/rest-nodrop.png" /></figure>

<figure><figcaption><span></span></figcaption><img style="" src="/book-of-gehn/assets/distributing/constant_rate/examples/rest-drop.png" /></figure>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/10/04/Index-of-Coincidence.html"><h2 class="larger">Index of Coincidence Explained</h2></a>
          <br><span class="smaller">October 4, 2019</span>  <br/>
          <div><p>The concept of Index of Coincidence was introduced by William Friedman
in 1922-1923 in the paper titled
“The Index of Coincidence and its Applications in Cryptoanalysis”.</p>

<p>The Navy Department (US) worked in the following years on this topic
coming, in 1955, with a paper titled “The Index of Coincidence”
by Howard Campaigne.</p>

<p>However I found some confusing and misleading concepts in the <em>modern</em>
literature.</p>

<p>This post is a summary of what I could understand from Howard’s work.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/10/01/Writeup-EKO2019-Cipherchat.html"><h2 class="larger">Cipherchat (Crypto writeup - EKO 2019)</h2></a>
          <br><span class="smaller">October 1, 2019</span>  <br/>
          <div><p>We start with a <a href="/book-of-gehn/assets/eko2019-writeups/cipherchat-dir/cipherchat.pcap">communication</a>
between two machines, encrypted with an unknown algorithm and
the challenge is to break it.</p>

<p>As a <em>hint</em> we have the code that the client used to talk with the server.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/09/29/Writeup-EKO2019-Weirdo.html"><h2 class="larger">Weirdo (SQLi writeup - EKO 2019)</h2></a>
          <br><span class="smaller">September 29, 2019</span>  <br/>
          <div><p>Quick writeup of a SQL injection challenge.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/08/22/CTR-Bitfliping.html"><h2 class="larger">CTR Bitflipping</h2></a>
          <br><span class="smaller">August 22, 2019</span>  <br/>
          <div><p>No much to explain: encryption <strong>does not</strong> offer any
protection against forgery.</p>

<p>We saw this in the <a href="/book-of-gehn/articles/2018/07/03/CBC-Bitflipping.html">CBC Bitflipping post</a>
and we will see it again here but this time it will be
the CTR encryption mode our victim.<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/08/04/Better-Compression-Log-Files-PoC.html"><h2 class="larger">Better Compression of Log Files (PoC)</h2></a>
          <br><span class="smaller">August 4, 2019</span>  <br/>
          <div><p>The logs present several patterns that are repeated again and again;
LZMA takes advantage of that and reaches very high compress ratios.</p>

<p>Doing a quick test, LZMA at the 6 level of compression, compressed
a 2.5 GB log into 147 MB very tight binary blog. A ratio of 94.069%,
not bad!</p>

<p>But could we get better results?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/07/25/From-Regex-to-Nondeterministic-Finite-Automata.html"><h2 class="larger">From a Regex to a Nondeterministic Finite Automata</h2></a>
          <br><span class="smaller">July 25, 2019</span>  <br/>
          <div><p>Before building complex state machine we need to learn the basics blocks.</p>

<p>When the solution to a problem can be seen as set of states with
transitions from ones to others, modeling them as a nondeterministic
finite automatas makes clear how the solution works and allows to spot
deficiencies.</p>

<p>A regular expression is an example of this. As an introductory step
let’s review how to turn a regex into a NFA.</p>

<p>Take at look of the <a href="https://github.com/eldipa/nfa">source code in Github</a>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/05/08/CTR-Edit-Inject-Plaintext-Attacks.html"><h2 class="larger">CTR Edit/Inject Plaintext Attacks</h2></a>
          <br><span class="smaller">May 8, 2019</span>  <br/>
          <div><p>A CTR-mode cipher turns a block cipher into a stream cipher.</p>

<p>With this, a ciphertext can be edited <em>in place</em> generating
enough of the key stream, decrypting and re-encrypting the edited
portion.</p>

<p>One can replace part of the plaintext, extend it or even reduce it.</p>

<p>But this beautiful property of a CTR mode (and any other stream cipher)
is actually a booby-trap.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/03/20/Affine-Ciphers.html"><h2 class="larger">Affine Cipher</h2></a>
          <br><span class="smaller">March 20, 2019</span>  <br/>
          <div><p>A <em>linear</em> cipher like the Hill Cipher is
<a href="/book-of-gehn/articles/2019/01/02/Break-Hill-Cipher-with-a-Known-Plaintext-Attack.html">vulnerable</a>
to a known plaintext attack: just resolve a set of linear
equations and get the secret key.</p>

<p>An <em>affine</em> cipher is a little harder to break, however it could
be vulnerable to a <em>differential</em> attack.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/03/15/Separate-your-SSH-Agent-Identities.html"><h2 class="larger">Separate your SSH Agent Identities</h2></a>
          <br><span class="smaller">March 15, 2019</span>  <br/>
          <div><p>Using a <code class="highlighter-rouge">ssh-agent</code> to handle our keys is handy.</p>

<p>When you need to access to different hosts jumping from one to another,
<em>forwarding</em> the agent is much more secure than copying and pasting
your keys around.</p>

<p>But if one host gets compromised it will expose your agent: even if the
attacker will not get your secret keys he will be able to login into
any system as you.</p>

<p>You cannot prevent this, but you can restrict this to reduce the splash
damage.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/02/03/Cape-Encryption.html"><h2 class="larger">Cape Encryption</h2></a>
          <br><span class="smaller">February 3, 2019</span>  <br/>
          <div><p>The Cape library<label for="mn-4bc32159a5b520259ac8bbc444bdd485" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-4bc32159a5b520259ac8bbc444bdd485" class="margin-toggle" /><span class="marginnote">https://github.com/gioblu/Cape/tree/294f810ac4831af26832e70e4ba5d073908232e2 </span>
offers a symmetric stream cipher implemented in
<code class="highlighter-rouge">cape_decrypt</code> and <code class="highlighter-rouge">cape_encrypt</code>.</p>

<p>In addition, it offers another symmetric stream cipher, a slightly different
of the first one, implemented in <code class="highlighter-rouge">cape_hash</code><label for="mn-07e3f75f5385a05dda74ee8bdc043d42" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-07e3f75f5385a05dda74ee8bdc043d42" class="margin-toggle" /><span class="marginnote"><code class="highlighter-rouge">cape_hash</code> is an unfortunately name for a cipher. </span></p>

<p>In this write-up we are going to analyze the <code class="highlighter-rouge">cape_hash</code> stream cipher
and see if we can break it.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2019/01/02/Break-Hill-Cipher-with-a-Known-Plaintext-Attack.html"><h2 class="larger">Break Hill Cipher with a Known Plaintext Attack</h2></a>
          <br><span class="smaller">January 2, 2019</span>  <br/>
          <div><p>Given a matrix secret key <script type="math/tex">K</script> with shape <script type="math/tex">n\textrm{x}n</script>, the
<a href="https://en.wikipedia.org/wiki/Hill_cipher">Hill cipher</a> splits
the plaintext into blocks of length <script type="math/tex">n</script> and for each block, computes
the ciphertext block doing a linear transformation in module <script type="math/tex">m</script></p>

<script type="math/tex; mode=display">K p_i = c_i\quad(\textrm{mod } m)</script>

<p>For decrypting, we apply the inverse of <script type="math/tex">K</script></p>

<script type="math/tex; mode=display">p_i = [K]^{-1} c_i \quad(\textrm{mod } m)</script>

<p>To make sense, the secret key <script type="math/tex">K</script> must be chosen such as its inverse
exists in module <script type="math/tex">m</script>.</p>

<p>Ready to break it?</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/12/23/Mersenne-Twister-PRNG.html"><h2 class="larger">Breaking MT19937 Crypto</h2></a>
          <br><span class="smaller">December 23, 2018</span>  <br/>
          <div><p>The Mersenne-Twister 19937 or just MT19937 is one of the most
used pseudo random number generator with a quite large cycle length
and with a nice random quality.</p>

<p>However it was not designed to be used for crypto.</p>

<p>But some folks may not know this…<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/12/04/Fixed-Nonce-CTR-Attack.html"><h2 class="larger">Fixed Nonce CTR Attack</h2></a>
          <br><span class="smaller">December 4, 2018</span>  <br/>
          <div><p>The Counter mode, or just CTR mode, turns a block cipher into a stream cipher.</p>

<p>More specifically, it builds a pseudo random generator (PRG)
from a block cipher and then generates a random string using
the PRG to encrypt/decrypt the payload performing a simple xor.</p>

<p>The idea is to initialize the PRG with a different <em>seed</em> each time
but if this does not happen, all the plaintexts will be encrypted
with the <em>same</em> pseudo random key stream – totally insecure.</p>

<p>Ready to break it?<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/10/28/CBC-Padding-Oracle.html"><h2 class="larger">CBC Padding Oracle Attack</h2></a>
          <br><span class="smaller">October 28, 2018</span>  <br/>
          <div><p>AES and other ciphers work on blocks; if the plaintext length
is not multiple of the block size a padding is added.</p>

<p>If during the decryption the pad is checked and returns an error,
we can use this to build a <em>padding oracle</em>:
a function that will tell us if an encrypted plaintext
has a valid pad or not.</p>

<p>Armed with this <em>padding oracle</em> we can break CBC
one byte at time.</p>

<p>Ready?<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span> <em>Go!</em></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/10/01/Magic-Bash-Runes.html"><h2 class="larger">() { Magic Bash Runes</h2></a>
          <br><span class="smaller">October 1, 2018</span>  <br/>
          <div><p>Despite of been 4 years old, <code class="highlighter-rouge">Shellshock</code> is still a very interesting
topic to me not for the vulnerability itself but for the large
ways to trigger it even in the most unexpected places.</p>

<p>Take the 4 characters <code class="highlighter-rouge">() {</code> and open the world.
<label for="mf-f40ce0988735db556d111316cae05d24" class="margin-toggle ">⊕</label><input type="checkbox" id="mf-f40ce0988735db556d111316cae05d24" class="margin-toggle " /><span class="marginnote "><img class="fullwidth" alt="Fragments found in the field." src="/book-of-gehn/assets/shellshock/runes.png" />  <br /></span></p>

<p>Creativity and few hours reading man pages are all what you need.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/09/16/Ouroboros-Circular-Buffer.html"><h2 class="larger">Ouroboros - Circular Buffer</h2></a>
          <br><span class="smaller">September 16, 2018</span>  <br/>
          <div><p><code class="highlighter-rouge">struct circular_buffer</code> is a simple but quite efficient implementation
of a circular buffer over a continuous and finite memory slice.</p>

<p>The name <a href="https://en.wikipedia.org/wiki/Ouroboros">Ouroboros</a> comes from the
Ancient Greek and symbolize a snake eating
its own tail – a convenient image for a circular buffer.</p>

<figure><figcaption><span></span></figcaption><img style="" src="/book-of-gehn/assets/circular_buffer/buffer_0_10.png" /></figure>

<p>Source code can be found in the
<a href="https://github.com/eldipa/tiburoncin">tiburoncin project</a>. Enjoy it!</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/07/03/CBC-Bitflipping.html"><h2 class="larger">CBC Bitflipping</h2></a>
          <br><span class="smaller">July 3, 2018</span>  <br/>
          <div><p><label for="mf-03e66d641fdb1dcfe295e7a3a6f369fb" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-03e66d641fdb1dcfe295e7a3a6f369fb" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img style="max-width:60%;" alt="CBC Dec" src="/book-of-gehn/assets/matasano/cbc-dec.png" />  <br /></span></p>

<p>CBC does not offer any protection against an active attacker.</p>

<p>Flipping some bits in a ciphertext block totally scrambles its
plaintext but it has a very specific effect in the <em>next</em> plaintext
block.</p>

<p>Without any message integrity, a CBC ciphertext can be patched
to modify the plaintext at will.<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/07/01/Cut-and-Paste-ECB-Blocks.html"><h2 class="larger">Cut and Paste ECB blocks</h2></a>
          <br><span class="smaller">July 1, 2018</span>  <br/>
          <div><p>In this game we control partially a plaintext that is encrypted
under ECB mode with a secret key.</p>

<p>This time the idea is not to reveal the key but to <em>forge</em> a plaintext.</p>

<p>Welcome to the <a href="https://cryptopals.com/sets/2/challenges/13">ECB cut-and-paste</a>
challenge!<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/06/10/Breaking-ECB.html"><h2 class="larger">Breaking ECB</h2></a>
          <br><span class="smaller">June 10, 2018</span>  <br/>
          <div><p>In the previous post we built
<a href="/book-of-gehn/articles/2018/06/09/ECB-CBC-Oracle.html">an ECB/CBC oracle</a>;
now it’s time to take this to the next level and
break ECB <a href="https://cryptopals.com/sets/2/challenges/14">one byte at time</a>.
<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/06/09/ECB-CBC-Oracle.html"><h2 class="larger">ECB/CBC Oracle</h2></a>
          <br><span class="smaller">June 9, 2018</span>  <br/>
          <div><p>In this post will review the Cipher Block Chaining mode (or CBC)
and how we can build
<a href="https://cryptopals.com/sets/2/challenges/11">an ECB/CBC detection oracle</a>
to distinguish ECB from CBC using
<a href="https://pypi.org/project/cryptonita/">cryptonita</a></p>

<p>This will be the bases for <a href="/book-of-gehn/articles/2018/06/10/Breaking-ECB.html">breaking ECB</a>
in a later post.<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span>.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/05/20/Detecting-Penguins.html"><h2 class="larger">Detecting Penguins</h2></a>
          <br><span class="smaller">May 20, 2018</span>  <br/>
          <div><figure><figcaption><span>The ECB encrypted image on the right
and its plaintext original version on the left. Image taken from
<a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">wikipedia</a>.</span></figcaption><img src="/book-of-gehn/assets/matasano/tux.png" /></figure>

<p>Can you see the penguin?<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/05/01/Breaking-Vigenere.html"><h2 class="larger">Breaking Vigenere</h2></a>
          <br><span class="smaller">May 1, 2018</span>  <br/>
          <div><p>A plaintext was encrypted via a XOR with key of unknown bytes of length,
repeating this key as much as needed to cover the full length of
the plaintext.</p>

<p>This is also known as the
<a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenere cipher</a>.</p>

<p>It is 101 cipher, which it is easy to break in theory, but it has more than
one challenge hidden to be resolve in the practice.</p>

<p>Shall we?<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/04/01/A-string-of-coincidences-is-not-a-coincidence.html"><h2 class="larger">A string of coincidences is not a coincidence</h2></a>
          <br><span class="smaller">April 1, 2018</span>  <br/>
          <div><p>A cipher is <em>semantically secure</em> if given a randomly chosen key, its ciphertext
cannot be distinguishable from a truly random string.</p>

<p>Detecting a ciphertext from a pool is enough to consider
the cipher as not secure even of we can’t break it.</p>

<p>In the following pool of random strings one is actually a ciphertext
that is the <code class="highlighter-rouge">xor</code> encryption of a plaintext using a single-byte key.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">cryptonita</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">load_bytes</span>     <span class="c1"># byexample: +timeout=10
</span><span class="o">&gt;&gt;&gt;</span> <span class="n">ciphertexts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">load_bytes</span><span class="p">(</span><span class="s">'./assets/matasano/4.txt'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></div>

<p>This is obviously a poor and not secure encryption mechanism; let’s find
the ciphertext then!<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2018/03/01/In-XOR-We-Trust.html"><h2 class="larger">In XOR we trust</h2></a>
          <br><span class="smaller">March 1, 2018</span>  <br/>
          <div><p>This is the first set of exercises for the
<a href="https://cryptopals.com/">Matasano Challenge</a> (also known as
the Cryptopals Challenge)</p>

<p>It starts from the very begin, really easy, but it goes up to more
challenging exercises quickly.</p>

<p>Ready?<label for="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle"> ⊕</label><input type="checkbox" id="mn-92c40aed2262db60522dbf16855f07d8" class="margin-toggle" /><span class="marginnote"><strong>– Spoiler Alert! –</strong> </span> <em>Go!</em></p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2017/04/16/Isolate-wifi-and-keep-traffic-out-Big-Brother-sight.html"><h2 class="larger">Isolate a wifi card and keep your traffic out of the Big Brother sight</h2></a>
          <br><span class="smaller">April 16, 2017</span>  <br/>
          <div><p><label for="mf-9d56bae39ef3717a0ac0633d00b3095c" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-9d56bae39ef3717a0ac0633d00b3095c" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img style="" class="fullwidth" alt="Big Brother sight" src="/book-of-gehn/assets/isolate_wifi/isolate_wifi_big_brother_sight.png" />  <br /></span></p>

<p>HTTP Proxies blacklisting evil domains, firewalls blocking weird traffic
and IDSs looking for someone that shouldn’t be there are reasonable and
understandable policies for a corporate environment.</p>

<p>But when a friend opened his browser this week and went to <code class="highlighter-rouge">google.com</code>
the things got odd.</p>

<p>The browser refused the connection warning him that the SSL certificate
of the server wasn’t issue by <code class="highlighter-rouge">google.com</code> at all or signed by a
trusted authority.</p>

</div>
       </span>
    
       <span class="index-single-post">
          <hr class="slender post-layout">
          <a href="/book-of-gehn/articles/2016/12/18/Forensics-911-recovering-thesis.html"><h2 class="larger">Forensics 911 - recovering a thesis of one year work</h2></a>
          <br><span class="smaller">December 18, 2016</span>  <br/>
          <div><p><label for="mf-5d444facb38e79ef0c8ab5be26ebb333" class="margin-toggle  in-index-only">⊕</label><input type="checkbox" id="mf-5d444facb38e79ef0c8ab5be26ebb333" class="margin-toggle  in-index-only" /><span class="marginnote  in-index-only"><img style="" class="fullwidth" alt="Trimming and Scraping" src="/book-of-gehn/assets/trimming_scraping_ddrescue.png" />  <br />Trimming and Scraping</span></p>

<p>A friend of mine called me: a girl friend of him was hopeless trying to recover her thesis from a corrupted usb stick <em>three days</em> before her presentation.</p>

<p>She was working in her thesis for almost a year, saving all the progresses in that usb stick. But what she didn’t know was that an usb memory has a limited number of writes and with more writes eventually the file system gets corrupted.</p>

<p>This is the real story behind a forensics rally trying to recover her one year work.</p>

</div>
       </span>
    




    </article>
    <span class="print-footer"> - Gehn</span>
    <footer>
    <hr class="slender">
    <div class="credits">
        <span>&copy; 2021
            
            Gehn
        </span></br>
            <a style="text-decoration: none;" href="/book-of-gehn/feed.xml"><img height="16px" width="16px" src="/book-of-gehn/assets/blog-assets/rss-32px.png" /></a>
        <br>
        

    
    </div>
</footer>

  </body>
</html>
