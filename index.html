<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>The Book of Gehn</title>
  <meta name="description" content="blog">

  <link href='/css/load-lato-fonts.min.css' rel='stylesheet' type='text/css'>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      //root: "/js/MathJax-2.7.7",
      extensions: ["tex2jax.js"],
      jax: ["input/TeX","output/HTML-CSS"],
      tex2jax: {inlineMath: [["\\(","\\)"]]},
      TeX: {
        Macros: {
          
        }
      }
    });
  </script>
  <!-- <script src='/js/MathJax-2.7.7/MathJax.js' async></script> -->
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js' async></script>

  <script src="/js/jquery-3.6.0.min.js"></script>

  <script src='/js/underscore-1.9.1.min.js' ></script>

  <script src='/js/d3-7.4.2.min.js'></script>

  <script src='/js/venn/venn-0.2.14.min.js'></script>
  <script src='/js/venn/helper.min.js'></script>

  <script src='/js/fix_syntax_highlight.min.js'></script>
  <link rel="stylesheet" type="text/css" href="/css/tufte.min.css">
  <link rel="stylesheet" type="text/css" href="/css/latex.min.css">

  <link rel="canonical" href="https://book-of-gehn.github.io/pages/index.html">

  <link rel="stylesheet" type="text/css" href="/css/font-awesome-5.min.css">

  <script src='/js/lunr-2.3.9.min.js'></script>
  <script src='/js/search_index.js'></script>
  <script src='/js/search.min.js'></script>
</head>
<body>
<header>
                <hgroup class="header-group">
        <h1 class="header-title"><a href="/">The Book of Gehn</a></h1>
                </hgroup>
                <ul class="header-list">
                    <li><a href="https://byexamples.github.io">byexample</a></li>
                    <li><a href="https://bisturi.github.io">bisturi</a></li>
                    <li>
                        <a class="raw_link" href="/atom.xml"><img height="16px" width="16px" src="/img/rss-32px.png" /></a>
                        <a class="raw_link" href="https://github.com/eldipa"><img height="16px" width="16px" src="/img/github.png" /></a>
                    </li>
                </ul>
        
        

    

    <nav class="group">
            <form id="blog-search-form">
                <input type="search" placeholder="+must -not *fuzzy*"></input>
                <span class="query-error"></span>
                <span class="controls">
                    <button type="submit">Filter</button>
                    <button style="display: none;" id="reset_search" type="reset">Clear</button>
                </span>
            </form>
    </nav>

    <div style="display: none;" id="search_error"></div>
    <article style="display: none;" class="group" id="search_results">
    </article>
</header>
<article class="group">
<h1>
</h1>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2023/01/23/Key-Recovering-from-CBC-with-IV-eq-K.html">
<h2 class="larger">
Key Recovering from CBC with \(IV = K\)
</h2>
</a> <br><span class="smaller">January 23, 2023</span> <br/>
<div>
<p><label for='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL21hdGFzYW5vL2stZXEtaXYtZW5jLnN2ZycgLz4KbWFyZ2lu' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL21hdGFzYW5vL2stZXEtaXYtZW5jLnN2ZycgLz4KbWFyZ2lu' class='margin-toggle'/>
<span class='marginnote'>
<img style="width: 100%;" class='fullwidth' alt='' src='/img/matasano/k-eq-iv-enc.svg' />
</span></p>
<p>CBC requires an <em>initialization vector</em> (IV) that needs to be agreed by both encryption and decryption peers.</p>
<p>IV needs to be random so you may be get tempted and use the secret key as IV.</p>
<p>No, please don’t.</p>
<p>The IV is not required to be secret and there is a good reason for that: it can be recovered with a <strong>single</strong> <em>chosen ciphertext attack</em>.</p>
<p>Using \(IV = K\) means that the adversary can recover the secret key with a single message.</p>
<p>In this post I describe the attack in 3 simple diagrams.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/10/01/Diff-Between-Dataframes-for-Testing.html">
<h2 class="larger">
Diff Between Data Frames for Testing
</h2>
</a> <br><span class="smaller">October 1, 2022</span> <br/>
<div>
<p>Let’s say that we want to compare two Pandas’ dataframes for unit testing.</p>
<p>One is the <em>expected</em> dataframe, crafted by us and it will be the <em>source of truth</em> for the test.</p>
<p>The other is the <em>obtained</em> dataframe which is the result of the experiment that we want to check.</p>
<p>Doing a naive comparison will not work: first we may want to <em>tolerate</em> some minor differences due computation imprecision; and second, and most important, we don’t want to know <em>just</em> if the dataframes are different or not</p>
<p>We want to know <strong>where are the differences</strong>.</p>
<p>Knowing exactly what is different makes the debugging much easier – trying to figure out which column in which row there is a different by hand is <strong>not fun</strong>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/08/27/Compress-Old-Audio-Files.html">
<h2 class="larger">
Compress Old Audio Files
</h2>
</a> <br><span class="smaller">August 27, 2022</span> <br/>
<div>
<p>We the pass of the years one keeps storing files, music in my case.</p>
<p>A few thousands.</p>
<p>But technology improved in this sense and new encoders exist that can compress (loosely) the same audio with the same quality but at a much smaller bit rate, and therefore, resulting in much smaller files.</p>
<p>Quick and dirty script follows!</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/07/17/Lessons-Learnt-Optimizing-Pyte.html">
<h2 class="larger">
Lessons Learnt Optimizing Pyte
</h2>
</a> <br><span class="smaller">July 17, 2022</span> <br/>
<div>
<p>Few thoughts about Python code optimization and benchmarking for <a href="https://github.com/selectel/pyte">pyte</a> and <a href="/articles/2022/07/15/Sparse-Aware-Optimizations-for-Terminal-Emulator-Pyte.html">summarized here</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/07/15/Sparse-Aware-Optimizations-for-Terminal-Emulator-Pyte.html">
<h2 class="larger">
Sparse Aware Optimizations for Terminal Emulator Pyte
</h2>
</a> <br><span class="smaller">July 15, 2022</span> <br/>
<div>
<p><a href="https://byexamples.github.io/byexample/">byexample</a> is a tool that reads snippets of code from your documentation, executes them and compares the obtained results with the expected ones, from your docs too.</p>
<p>If a mismatch happen we say that the <em>example</em> in your documentation failed which could mean one fo two things:</p>
<ul>
<li>your code (the snippet) does not do what you expect so it has a bug</li>
<li>or the code does exactly what it is supposed but you forgot to update your doc.</li>
</ul>
<p><em>Very useful for testing and keep your docs in sync!</em></p>
<p>But <a href="https://byexamples.github.io/byexample/">byexample</a> does not really execute anything by itself. Having to code an interpreter for Ruby, Java, C++ and others would be <em>insane</em>.</p>
<p>Instead, <a href="https://byexamples.github.io/byexample/">byexample</a> sends the snippets of code toa standard interpreter like <a href="https://github.com/ruby/irb">IRB</a> for Ruby or <a href="https://github.com/root-project/cling">cling</a> for C++.</p>
<p>Interpreting the output from they is not always trivial.</p>
<p>When a interpreter prints to the terminal, it may write special <a href="https://en.wikipedia.org/wiki/ANSI_escape_code">escape/control sequences</a>, invisible to human eyes, but interpreted by the terminal.</p>
<p>That’s how IRB can tell your terminal to output something with reds and blues colors.</p>
<p><label for='ClRoYXQncyBob3cgYGJ5ZXhhbXBsZWAncwpbYCt0ZXJtPWFuc2lgXShodHRwczovL2J5ZXhhbXBsZXMuZ2l0aHViLmlvL2J5ZXhhbXBsZS9hZHZhbmNlZC90ZXJtaW5hbC1lbXVsYXRpb24pCmlzIGltcGxlbWVudGVkLgptYXJnaW5ub3Rlcw==' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='ClRoYXQncyBob3cgYGJ5ZXhhbXBsZWAncwpbYCt0ZXJtPWFuc2lgXShodHRwczovL2J5ZXhhbXBsZXMuZ2l0aHViLmlvL2J5ZXhhbXBsZS9hZHZhbmNlZC90ZXJtaW5hbC1lbXVsYXRpb24pCmlzIGltcGxlbWVudGVkLgptYXJnaW5ub3Rlcw==' class='margin-toggle'/>
<span class='marginnote'>
That’s how <code>byexample</code>’s <a href="https://byexamples.github.io/byexample/advanced/terminal-emulation"><code>+term=ansi</code></a> is implemented.
</span></p>
<p><a href="https://byexamples.github.io/byexample/">byexample</a> has no idea of what the hell those control sequences are and relays on a <em>terminal emulator</em>: <a href="https://github.com/selectel/pyte">pyte</a></p>
<p><figure><figcaption><span markdown='1'>
<code>byexample</code> sends the snippets to the correct interpreter and its output <em>feeds</em> <code>pyte.Screen</code>. It is the plain text from the emulated terminal what <code>byexample</code> uses to compare with the expected output from the example.
</span></figcaption>
<img  class='' alt='' src='/img/python/pyte/byexample-pyte-overview.png' /></figure></p>
<p>But <code>pyte</code> may take <strong>seconds</strong> to process a single output so <code>byexample</code> never enabled it by default.</p>
<p>This post describes the <em>why</em> and <em>how</em> of the <a href="https://github.com/byexamples/pyte/tree/Screen-Optimizations">optimizations contributed</a> to <code>pyte</code> to go from seconds to <strong>microseconds</strong>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/07/14/TLDR-Screen-Optimizations-Results.html">
<h2 class="larger">
TL;DR Screen Optimizations Results for Terminal Emulator Pyte
</h2>
</a> <br><span class="smaller">July 14, 2022</span> <br/>
<div>
<p>This post describes to some level of detail all the performance boosts and speedups due the <a href="https://github.com/byexamples/pyte/tree/Screen-Optimizations">optimizations contributed</a> to <a href="https://github.com/selectel/pyte">pyte</a> and <a href="/articles/2022/07/15/Sparse-Aware-Optimizations-for-Terminal-Emulator-Pyte.html">summarized here</a></p>
<p>For large geometries (240x800, 2400x8000), <code>Screen.display</code> runs orders of magnitud faster and consumes between 1.10 and 50.0 times less memory.</p>
<p>For smaller geometries the minimum improvement was of 2 times faster.</p>
<p><code>Stream.feed</code> is now between 1.10 and 7.30 times faster and if <code>Screen</code> is tuned, the speedup is between 1.14 and 12.0.</p>
<p>For memory usage, <code>Stream.feed</code> is between 1.10 and 17.0 times lighter and up to 44.0 times lighter if <code>Screen</code> is tuned.</p>
<p><code>Screen.reset</code> is between 1.10 and 1.50 slower but several cases improve if the <code>Screen</code> is tuned (but not all).</p>
<p>However there are a few regressions, most of them small but some up to 4 times.</p>
<p>At the moment of writing this post, the PR is still pending to review.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/04/27/Linux-Control-Group-No-Internal-Process-Constraint.html">
<h2 class="larger">
Control Group - No Internal Process Constraint
</h2>
</a> <br><span class="smaller">April 27, 2022</span> <br/>
<div>
<!--
$ test -d /sys/fs/cgroup/test && echo "cgroup test/ already created!"     # byexample: +fail-fast
-->
<p><label for='ClByZXZpb3VzIHBvc3RzOiBbaGllcmFyY2hpY2FsIG9yZ2FuaXphdGlvbl0oL2FydGljbGVzLzIwMjIvMDQvMjMvTGludXgtQ29udHJvbC1Hcm91cC1IaWVyYXJjaGljYWwtT3JnYW5pemF0aW9uLmh0bWwpCjxiciAvPgphbmQgW3Jlc291cmNlcyBkaXN0cmlidXRpb25dKC9hcnRpY2xlcy8yMDIyLzA0LzI0L0xpbnV4LUNvbnRyb2wtR3JvdXAtUmVzb3VyY2UtRGlzdHJpYnV0aW9uLmh0bWwpCm1hcmdpbm5vdGVz' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='ClByZXZpb3VzIHBvc3RzOiBbaGllcmFyY2hpY2FsIG9yZ2FuaXphdGlvbl0oL2FydGljbGVzLzIwMjIvMDQvMjMvTGludXgtQ29udHJvbC1Hcm91cC1IaWVyYXJjaGljYWwtT3JnYW5pemF0aW9uLmh0bWwpCjxiciAvPgphbmQgW3Jlc291cmNlcyBkaXN0cmlidXRpb25dKC9hcnRpY2xlcy8yMDIyLzA0LzI0L0xpbnV4LUNvbnRyb2wtR3JvdXAtUmVzb3VyY2UtRGlzdHJpYnV0aW9uLmh0bWwpCm1hcmdpbm5vdGVz' class='margin-toggle'/>
<span class='marginnote'>
Previous posts: <a href="/articles/2022/04/23/Linux-Control-Group-Hierarchical-Organization.html">hierarchical organization</a> <br /> and <a href="/articles/2022/04/24/Linux-Control-Group-Resource-Distribution.html">resources distribution</a>
</span></p>
<p>In the previous post we saw that we cannot enable a controller or add a process to a cgroup freely. That would make the implementation of each controller harder.</p>
<p>In <code>v2</code> the hierarchy is subject to the <em>no internal process</em> constraint which ensures that a controller will have all the processes in leaves of its domain tree.</p>
<p>This is the last of a 3-post series about <code>cgroup</code> and certainly, this <em>no internal process</em> constraint was the hardest to understand.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/04/24/Linux-Control-Group-Resource-Distribution.html">
<h2 class="larger">
Control Group - Resource Distribution
</h2>
</a> <br><span class="smaller">April 24, 2022</span> <br/>
<div>
<p><label for='ClByZXZpb3VzIHBvc3Q6IFtoaWVyYXJjaGljYWwgb3JnYW5pemF0aW9uXSgvYXJ0aWNsZXMvMjAyMi8wNC8yMy9MaW51eC1Db250cm9sLUdyb3VwLUhpZXJhcmNoaWNhbC1Pcmdhbml6YXRpb24uaHRtbCkKPGJyIC8+Ck5leHQgY29taW5nIHBvc3Q6IFtubyBpbnRlcm5hbCBwcm9jZXNzIGNvbnN0cmFpbnRdKC9hcnRpY2xlcy8yMDIyLzA0LzI3L0xpbnV4LUNvbnRyb2wtR3JvdXAtTm8tSW50ZXJuYWwtUHJvY2Vzcy1Db25zdHJhaW50Lmh0bWwpCm1hcmdpbm5vdGVz' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='ClByZXZpb3VzIHBvc3Q6IFtoaWVyYXJjaGljYWwgb3JnYW5pemF0aW9uXSgvYXJ0aWNsZXMvMjAyMi8wNC8yMy9MaW51eC1Db250cm9sLUdyb3VwLUhpZXJhcmNoaWNhbC1Pcmdhbml6YXRpb24uaHRtbCkKPGJyIC8+Ck5leHQgY29taW5nIHBvc3Q6IFtubyBpbnRlcm5hbCBwcm9jZXNzIGNvbnN0cmFpbnRdKC9hcnRpY2xlcy8yMDIyLzA0LzI3L0xpbnV4LUNvbnRyb2wtR3JvdXAtTm8tSW50ZXJuYWwtUHJvY2Vzcy1Db25zdHJhaW50Lmh0bWwpCm1hcmdpbm5vdGVz' class='margin-toggle'/>
<span class='marginnote'>
Previous post: <a href="/articles/2022/04/23/Linux-Control-Group-Hierarchical-Organization.html">hierarchical organization</a> <br /> Next coming post: <a href="/articles/2022/04/27/Linux-Control-Group-No-Internal-Process-Constraint.html">no internal process constraint</a>
</span></p>
<p>A system has hundreds of resources that process may use (and exhaust!): controlling them it is not trivial and requires a precise intervention by part of the kernel.</p>
<p>We’ll use the simplest resource to understand: the amount of process ids or pids.</p>
<p>While CPU and memory are the most common resources that can be exhausted, the process id <em>space</em> is not infinite: it is an integer typically in the range of 1 to \(2^{16}\).</p>
<p><label for='PG9iamVjdCBzdHlsZT0iZGlzcGxheTogYmxvY2s7IG1hcmdpbi1sZWZ0OiBhdXRvOyBtYXJnaW4tcmlnaHQ6IGF1dG87IiBjbGFzcz0nJyBhbGlnbj0nbWlkZGxlJyBkYXRhPScvaW1nL2tlcm5lbC9jZ3JvdXBzL3Rlc3Rpbmdfc2hlbGxfZWNob19jYXQuc3ZnJyB0eXBlPSdpbWFnZS9zdmcreG1sJz48L29iamVjdD5tYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PG9iamVjdCBzdHlsZT0iZGlzcGxheTogYmxvY2s7IG1hcmdpbi1sZWZ0OiBhdXRvOyBtYXJnaW4tcmlnaHQ6IGF1dG87IiBjbGFzcz0nJyBhbGlnbj0nbWlkZGxlJyBkYXRhPScvaW1nL2tlcm5lbC9jZ3JvdXBzL3Rlc3Rpbmdfc2hlbGxfZWNob19jYXQuc3ZnJyB0eXBlPSdpbWFnZS9zdmcreG1sJz48L29iamVjdD5tYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<object style="display: block; margin-left: auto; margin-right: auto;" class='' align='middle' data='/img/kernel/cgroups/testing_shell_echo_cat.svg' type='image/svg+xml'></object>
</span></p>
<p>A malicious or really-bugged program can trivially consume all the available pids spawning thousands of processes and threads <em>long before</em> other resource get exhausted. This the so called <em>fork bomb</em>.</p>
<p>Once you run out of pids, no other process can be started leaving the system unusable.</p>
<p>In this post we will explore the rules of resources distribution in a <code>cgroup</code> hierarchy and in particular how to avoid fork bombs to explode.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/04/23/Linux-Control-Group-Hierarchical-Organization.html">
<h2 class="larger">
Control Group - Hierarchical Organization
</h2>
</a> <br><span class="smaller">April 23, 2022</span> <br/>
<div>
<p><label for='PG9iamVjdCBzdHlsZT0iZGlzcGxheTogYmxvY2s7IG1hcmdpbi1sZWZ0OiBhdXRvOyBtYXJnaW4tcmlnaHQ6IGF1dG87IiBjbGFzcz0nJyBhbGlnbj0nbWlkZGxlJyBkYXRhPScvaW1nL2tlcm5lbC9jZ3JvdXBzL2Nncm91cC1zdGF0ZXMuc3ZnJyB0eXBlPSdpbWFnZS9zdmcreG1sJz48L29iamVjdD5tYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PG9iamVjdCBzdHlsZT0iZGlzcGxheTogYmxvY2s7IG1hcmdpbi1sZWZ0OiBhdXRvOyBtYXJnaW4tcmlnaHQ6IGF1dG87IiBjbGFzcz0nJyBhbGlnbj0nbWlkZGxlJyBkYXRhPScvaW1nL2tlcm5lbC9jZ3JvdXBzL2Nncm91cC1zdGF0ZXMuc3ZnJyB0eXBlPSdpbWFnZS9zdmcreG1sJz48L29iamVjdD5tYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<object style="display: block; margin-left: auto; margin-right: auto;" class='' align='middle' data='/img/kernel/cgroups/cgroup-states.svg' type='image/svg+xml'></object>
</span></p>
<p>Control group or <code>cgroup</code> is a mechanism to distribute and enforce limits over the resources of the system.</p>
<p>It was introduced in Linux kernel around 2007 but its complexity leaded to inconsistent behaviour and hard adoption.</p>
<p>Fast forwarding 9 years, in kernel 4.5 a rewrite of <code>cgroup</code> revamp the idea, making it simpler and consistent.</p>
<p>This post focus in the organization of cgroups and it is the first of a 3-posts series about <code>cgroup</code> in its new <code>v2</code> version.</p>
<p>In the next posts we will see how the <a href="/articles/2022/04/24/Linux-Control-Group-Resource-Distribution.html">resources are distributed</a> among the cgroups and <a href="/articles/2022/04/27/Linux-Control-Group-No-Internal-Process-Constraint.html">which constraints</a> do we have.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/03/06/Multiprocessing-Spawn-of-Dynamically-Imported-Code.html">
<h2 class="larger">
Multiprocessing Spawn of Dynamically Imported Code
</h2>
</a> <br><span class="smaller">March 6, 2022</span> <br/>
<div>
<p>The following snippet loads any Python module in the <code>./plugins/</code> folder.</p>
<p>This is the Python 3.x way to load code dynamically.</p>
<div class="highlight-candombe"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">load_modules</span><span class="p">():</span>
<span class="o">...</span>     <span class="n">dirnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;plugins/&quot;</span><span class="p">]</span>
<span class="o">...</span>     <span class="n">loaded</span> <span class="o">=</span> <span class="p">[]</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="c1"># For each plugin folder, see which Python files are there</span>
<span class="o">...</span>     <span class="c1"># and load them</span>
<span class="o">...</span>     <span class="k">for</span> <span class="n">importer</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">is_pkg</span> <span class="ow">in</span> <span class="n">pkgutil</span><span class="o">.</span><span class="n">iter_modules</span><span class="p">(</span><span class="n">dirnames</span><span class="p">):</span>
<span class="o">...</span>
<span class="o">...</span>         <span class="c1"># Find and load the Python module</span>
<span class="o">...</span>         <span class="n">spec</span> <span class="o">=</span> <span class="n">importer</span><span class="o">.</span><span class="n">find_spec</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="o">...</span>         <span class="n">module</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">module_from_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
<span class="o">...</span>         <span class="n">spec</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">exec_module</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
<span class="o">...</span>         <span class="n">loaded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
<span class="o">...</span>
<span class="o">...</span>         <span class="c1"># Add the loaded module to sys.module so it can be</span>
<span class="o">...</span>         <span class="c1"># found by pickle</span>
<span class="o">...</span>         <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">module</span>
<span class="o">...</span>
<span class="o">...</span>     <span class="k">return</span> <span class="n">loaded</span>
</code></pre></div>

<p>The loaded modules work as any other Python module. In a plugin system you typically will lookup for a specific function or a class that will serve as entry point or hooks for the plugin.</p>
<p>For example, in <a href="https://byexamples.github.io/byexample/contrib/how-to-support-new-finders-and-languages">byexample</a> the plugins must define classes that inherit from <code>ExampleFinder</code>, <code>ExampleParser</code>, <code>ExampleRunner</code> or <code>Concern</code>. These extend <code>byexample</code> functionality to find, parse and run examples in different languages and hook –via <code>Concern</code>– most of the execution logic.</p>
<p>Imagine now that one of the plugins implements a function <code>exec_bg</code> that needs to be executed in background, in a <strong>separated Python process</strong>.</p>
<p>We could do something like:</p>
<div class="highlight-candombe"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">loaded</span> <span class="o">=</span> <span class="n">load_modules</span><span class="p">()</span> <span class="c1"># loading the plugins</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mod</span> <span class="o">=</span> <span class="n">loaded</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># pick the first, this is just an example</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">target</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">mod</span><span class="p">,</span> <span class="s1">&#39;exec_bg&#39;</span><span class="p">)</span>  <span class="c1"># lookup plugin&#39;s exec_bg function</span>

<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">proc</span> <span class="o">=</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">proc</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>    <span class="c1"># run exec_bg in a separated process</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">proc</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</code></pre></div>

<p>This is plain simple use of <code>multiprocessing</code>…. and it will <strong>not</strong> work.</p>
<p>Well, it <em>will</em> work in Linux but not in MacOS or Windows.</p>
<p>In this post I will show why it will <strong>not</strong> work for dynamically loaded code (like from a plugin) and how to fix it.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/02/07/Hanoi-File-System.html">
<h2 class="larger">
Hanoi File System
</h2>
</a> <br><span class="smaller">February 7, 2022</span> <br/>
<div>
<p>Yeup, why not implement the classic <a href="https://en.wikipedia.org/wiki/Tower_of_Hanoi">Tower of Hanoi</a> using folders as the towers and files as the discs?</p>
<p>Using <a href="https://github.com/libfuse/libfuse">FUSE</a> we can implement a <em>file system</em> that can enforce the rules of the puzzle.</p>
<ul>
<li>each file would have a <em>size</em> that represent the disc’s size</li>
<li>one can move a file from one folder to another if the file is the smallest of the files of both folders</li>
</ul>
<p>Sounds fun?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2022/02/01/Fix-Ownership-of-Files-in-a-Mounted-Volume.html">
<h2 class="larger">
Fix Ownership of Files in a Mounted Volume
</h2>
</a> <br><span class="smaller">February 1, 2022</span> <br/>
<div>
<p>The file system of a docker container is ephemeral: it will disappear as soon as the container is destroyed.</p>
<p>To prevent data losses you can mount a folder <em>of the host</em> into the container which will survive the destroy of the container.</p>
<p>But it is not uncommon to find issues with the ownership and permissions of the <em>shared</em> files.</p>
<p>The file system of the host represents who is the owner of each file with an user and a group numbers.</p>
<p>Plain numbers.</p>
<p>Humans, on the other hand, think in terms of user names: <em>“this is the file of Alice; this other is of Bob”</em>.</p>
<p>The mapping between the numbers that the file system uses and the names that the humans understand is stored in <code>/etc/passwd</code> and <code>/etc/groups</code>.</p>
<p>And here we have a problem.</p>
<p>These two files, <code>/etc/passwd</code> and <code>/etc/groups</code>, live in the host’s file system and they are used to map the files’ numbers to names when you are seeing the files <em>from the host</em>.</p>
<p>When you enter into the docker container (or run a command inside), the shared files, mounted with <code>-v</code>, will have the <strong>same</strong> file numbers.</p>
<p>But, an here is the twist, inside the container you will be using for the mapping the <code>/etc/passwd</code> and <code>/etc/groups</code> files <em>of the container</em> and not of the host.</p>
<p>Same file numbers, different mappings.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/11/13/IPv4-Scan-Part-IV-Hop-Distance-and-IP-Distribution.html">
<h2 class="larger">
IPv4 Scan 2021 - Hop-Distance Average and IP Distribution
</h2>
</a> <br><span class="smaller">November 13, 2021</span> <br/>
<div>
<p><label for='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL25ldHdvcmsvaW50ZXJuZXRfc2Nhbi90dGxfaGlzdF9sb2dfc2NhbGUuc3ZnJyAvPgpIaXN0b2dyYW0gb2YgVFRMIG9ic2VydmVkOiB0aGUgcGVha3MgaW5kaWNhdGUgdGhlIGRpZmZlcmVudCBvcGVyYXRpdmUgc3lzdGVtcyBhbmQgdGhlaXIgcmVsYXRpdmUgcG9zaXRpb24gcmVzcGVjdCB0aGUgZXhwZWN0ZWQgcG9zaXRpb25zIGVzdGltYXRlIHRoZSBtZWFuIGRpc3RhbmNlIGJldHdlZW4gdGhlIGhvc3RzIGFuZCB0aGUgc2Nhbm5lciBpbiBob3AgY291bnQuCm1hcmdpbg==' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL25ldHdvcmsvaW50ZXJuZXRfc2Nhbi90dGxfaGlzdF9sb2dfc2NhbGUuc3ZnJyAvPgpIaXN0b2dyYW0gb2YgVFRMIG9ic2VydmVkOiB0aGUgcGVha3MgaW5kaWNhdGUgdGhlIGRpZmZlcmVudCBvcGVyYXRpdmUgc3lzdGVtcyBhbmQgdGhlaXIgcmVsYXRpdmUgcG9zaXRpb24gcmVzcGVjdCB0aGUgZXhwZWN0ZWQgcG9zaXRpb25zIGVzdGltYXRlIHRoZSBtZWFuIGRpc3RhbmNlIGJldHdlZW4gdGhlIGhvc3RzIGFuZCB0aGUgc2Nhbm5lciBpbiBob3AgY291bnQuCm1hcmdpbg==' class='margin-toggle'/>
<span class='marginnote'>
<img style="width: 100%;" class='fullwidth' alt='' src='/img/network/internet_scan/ttl_hist_log_scale.svg' />
Histogram of TTL observed: the peaks indicate the different operative systems and their relative position respect the expected positions estimate the mean distance between the hosts and the scanner in hop count.
</span></p>
<p>In the <a href="/articles/2021/09/19/IPv4-Scan-Part-II-Multiprobes-Analysis.html">Multiprobes Analysis</a>, we explored the statistics of the hosts and the communication to them.</p>
<p>This is a follow up to keep exploring the data:</p>
<ul>
<li>which is the average distance between a host and the scanner in term of hop count?</li>
<li>which OS are running?</li>
<li>how are the hosts distributed?</li>
</ul>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/11/13/IPv4-Scan-Part-V-TTL-Boost.html">
<h2 class="larger">
IPv4 Scan 2021 - TTL Boost (or reset)
</h2>
</a> <br><span class="smaller">November 13, 2021</span> <br/>
<div>
<p>In <a href="/articles/2021/10/16/IPv4-Scan-Part-III-Hop-stability.html">the post about Hop-Stability</a> we analyzed the TTL of the responses from all the scanned hosts.</p>
<p>In particular we used the TTL range: the difference between the smallest and the greatest TTL seen per host.</p>
<p><label for='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL25ldHdvcmsvaW50ZXJuZXRfc2Nhbi9tdWx0aXJvdW5kc190dGxfcmFuZ2VfdW5iaWFzZWRfX2hpc3Quc3ZnJyAvPgpIaXN0b2dyYW0gb2YgVFRMIHJhbmdlIGJldHdlZW4gcm91bmRzIG9mIHNjYW5zIHRvIHRoZSBzYW1lIGhvc3Qgc2hvd2luZyBob3cgbXVjaCBzdGFibGUgdGhlIHJvdXRlcyBhcmUuCm1hcmdpbg==' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL25ldHdvcmsvaW50ZXJuZXRfc2Nhbi9tdWx0aXJvdW5kc190dGxfcmFuZ2VfdW5iaWFzZWRfX2hpc3Quc3ZnJyAvPgpIaXN0b2dyYW0gb2YgVFRMIHJhbmdlIGJldHdlZW4gcm91bmRzIG9mIHNjYW5zIHRvIHRoZSBzYW1lIGhvc3Qgc2hvd2luZyBob3cgbXVjaCBzdGFibGUgdGhlIHJvdXRlcyBhcmUuCm1hcmdpbg==' class='margin-toggle'/>
<span class='marginnote'>
<img style="width: 100%;" class='fullwidth' alt='' src='/img/network/internet_scan/multirounds_ttl_range_unbiased__hist.svg' />
Histogram of TTL range between rounds of scans to the same host showing how much stable the routes are.
</span></p>
<p>With a range of 0 or very close we claimed that the route to the host was stable; with range larger than 7 we said the contrary.</p>
<p>The analysis shown that only 0.39998% of 43056567 unique hosts had unstable routes.</p>
<p>However the analysis was only using a few statistics, when we plot the <em>histogram of TTL ranges</em> we see much more <strong>mysteries to solve</strong>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/10/16/IPv4-Scan-Part-III-Hop-stability.html">
<h2 class="larger">
IPv4 Scan 2021 - Hop-Count Route Stability
</h2>
</a> <br><span class="smaller">October 16, 2021</span> <br/>
<div>
<p><a href="https://github.com/robertdavidgraham/masscan/">masscan</a> tracks the <em>time to live</em> of each packet coming from the host under scan.</p>
<p><label for='ClllcyBhbmQgbm86IHRoZXkgc2hvdWxkIG5vdCBidXQgc29tZSBuZXR3b3JrIGRldmljZXMgd2lsbCAqbWFuZ2xlIHRoZSBwYWNrZXRzCmFzIHRoZXkgd2FudCosIGluY2x1ZGluZyBzZXR0aW5nIGFyYml0cmFyeSBUVExzLgoKU2VlIHRoZSBvYnNlcnZhdGlvbnMgZG9uZSBpbiB0aGUKW1RUTCBCb29zdCBwb3N0XSgvYXJ0aWNsZXMvMjAyMS8xMS8xMy9JUHY0LVNjYW4tUGFydC1WLVRUTC1Cb29zdC5odG1sKS4KIG1hcmdpbm5vdGVz' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='ClllcyBhbmQgbm86IHRoZXkgc2hvdWxkIG5vdCBidXQgc29tZSBuZXR3b3JrIGRldmljZXMgd2lsbCAqbWFuZ2xlIHRoZSBwYWNrZXRzCmFzIHRoZXkgd2FudCosIGluY2x1ZGluZyBzZXR0aW5nIGFyYml0cmFyeSBUVExzLgoKU2VlIHRoZSBvYnNlcnZhdGlvbnMgZG9uZSBpbiB0aGUKW1RUTCBCb29zdCBwb3N0XSgvYXJ0aWNsZXMvMjAyMS8xMS8xMy9JUHY0LVNjYW4tUGFydC1WLVRUTC1Cb29zdC5odG1sKS4KIG1hcmdpbm5vdGVz' class='margin-toggle'/>
<span class='marginnote'>
Yes and no: they should not but some network devices will <em>mangle the packets as they want</em>, including setting arbitrary TTLs.
<br /><br />
See the observations done in the <a href="/articles/2021/11/13/IPv4-Scan-Part-V-TTL-Boost.html">TTL Boost post</a>.
</span></p>
<p>These time to live (TTL) are numbers between 0 and 255 set by the host. In its journey, the packet goes through different routers which each decrements by one the TTL.</p>
<p>Once a packet has a TTL of zero, the router will discard it.</p>
<p><label for='CkFzc3VtaW5nIHRoYXQgdGhlIHBhY2tldCBnb2VzIHN0cmFpZ2h0LWZvcndhcmQgdG8gdXMuIElmIHRoZXJlIGFyZQoqbG9vcHMqIGluIHRoZSByb3V0aW5nIHN5c3RlbXMsIHRoZSBwYWNrZXQgd2lsbCBsb29wIGJldHdlZW4gdGhlIGRldmljZXMKZ29pbmcgbm93aGVyZS4KPGJyIC8+ClRoYXQncyB0aGUgcG9pbnQgb2YgdGhlIFRUTDogdG8gY2F0Y2ggYW5kIGRyb3AgcGFja2V0cyBsb29waW5nIGFyb3VuZC4KIG1hcmdpbm5vdGVz' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='CkFzc3VtaW5nIHRoYXQgdGhlIHBhY2tldCBnb2VzIHN0cmFpZ2h0LWZvcndhcmQgdG8gdXMuIElmIHRoZXJlIGFyZQoqbG9vcHMqIGluIHRoZSByb3V0aW5nIHN5c3RlbXMsIHRoZSBwYWNrZXQgd2lsbCBsb29wIGJldHdlZW4gdGhlIGRldmljZXMKZ29pbmcgbm93aGVyZS4KPGJyIC8+ClRoYXQncyB0aGUgcG9pbnQgb2YgdGhlIFRUTDogdG8gY2F0Y2ggYW5kIGRyb3AgcGFja2V0cyBsb29waW5nIGFyb3VuZC4KIG1hcmdpbm5vdGVz' class='margin-toggle'/>
<span class='marginnote'>
Assuming that the packet goes straight-forward to us. If there are <em>loops</em> in the routing systems, the packet will loop between the devices going nowhere. <br /> That’s the point of the TTL: to catch and drop packets looping around.
</span></p>
<p>Of course the host set the TTL to some reasonable high number so the packet should reach to its destination (us) before reaching to zero.</p>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9uZXR3b3JrL2ludGVybmV0X3NjYW4vaXAtdHRsLXJhbmdlLWFuZC10aW1lLnBuZycgLz5tYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9uZXR3b3JrL2ludGVybmV0X3NjYW4vaXAtdHRsLXJhbmdlLWFuZC10aW1lLnBuZycgLz5tYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/network/internet_scan/ip-ttl-range-and-time.png' />
</span></p>
<p>We cannot know exactly which route/s the packets taken but we can <em>count for how many hops they went through</em>: any change in the <em>hop-count</em> and we will get different TTLs and that’s evidence that they taken different routes.</p>
<p>The inverse is not true: a constant hop-count does not imply that the route taken is the same, only the route/s have the same hops.</p>
<p>In this post I will <a href="/articles/2021/09/19/IPv4-Scan-Part-II-Multiprobes-Analysis.html">continue exploring</a> how much a <em>route</em> is <em>stable</em> in terms of <em>hop-counts</em>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/09/19/IPv4-Scan-Part-II-Multiprobes-Analysis.html">
<h2 class="larger">
IPv4 Scan 2021 - Multiprobes Analysis
</h2>
</a> <br><span class="smaller">September 19, 2021</span> <br/>
<div>
<p>To my surprise the <a href="https://www.kaggle.com/signalspikes/internet-port-scan-1">dataset</a> preprocessed in my <a href="/articles/2021/09/10/IPv4-Scan-Dataset-Preprocessing.html">previous post</a> <strong>has</strong> duplicated entries. These are scans to the same host and port but with a different timestamp.</p>
<p><label for='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL25ldHdvcmsvaW50ZXJuZXRfc2Nhbi90aW1lX2ludGVydmFsX2hpc3Quc3ZnJyAvPgpIaXN0b2dyYW0gb2YgdGhlIGludGVydmFsIGJldHdlZW4gcHJvYmVzIHRvIHRoZSBzYW1lIGhvc3QtcG9ydCBpbiBzZWNvbmRzLgptYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL25ldHdvcmsvaW50ZXJuZXRfc2Nhbi90aW1lX2ludGVydmFsX2hpc3Quc3ZnJyAvPgpIaXN0b2dyYW0gb2YgdGhlIGludGVydmFsIGJldHdlZW4gcHJvYmVzIHRvIHRoZSBzYW1lIGhvc3QtcG9ydCBpbiBzZWNvbmRzLgptYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<img style="width: 100%;" class='fullwidth' alt='' src='/img/network/internet_scan/time_interval_hist.svg' />
Histogram of the interval between probes to the same host-port in seconds.
</span></p>
<p>Questions like “which open port is more likely” will biased because the same host-port may be counted more than once.</p>
<p>On the other hand, this opens <em>new questions</em>:</p>
<ul>
<li>which is the reason to scan the same port more than once? If it is <em>fixed</em> by the scanner we can deduce that ports scanned once <em>were scanned more times</em> but the other probes failed and get an estimation of such.</li>
<li>is the same port opened due different reasons?</li>
<li>could we characterize the scanner based on the timestamps like scanning patterns?</li>
</ul>
<p>The second surprise was that even working with small samples (around 100MB), <a href="https://pandas.pydata.org/">Pandas</a>/<a href="https://dask.org/">Dask</a> has <strong>serious performance problems</strong>:</p>
<ul>
<li>consumes much more memory (gigas)</li>
<li>CPU at 100% all the time</li>
<li>simple operations like <code>groupby</code> take forever.</li>
</ul>
<p>Goodbye Pandas, hello <a href="https://julialang.org/">Julia</a>?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/09/10/IPv4-Scan-Dataset-Preprocessing.html">
<h2 class="larger">
IPv4 Scan 2021 - Dataset Preprocessing
</h2>
</a> <br><span class="smaller">September 10, 2021</span> <br/>
<div>
<p>The <a href="https://www.kaggle.com/signalspikes/internet-port-scan-1">dataset</a> is a survey or port scan of the whole IPv4 range made with <a href="https://github.com/robertdavidgraham/masscan">masscan</a>.</p>
<p>The dataset however is much smaller than the expected mostly because most of the hosts didn’t response and/or they had all the scanned ports closed.</p>
<p>Only open ports were registered.</p>
<p>More over, of the 65536 available ports only a few were scanned and only for the TCP protocol.</p>
<p>Even with such reduced scope the dataset occupies around 9 GB.</p>
<p>This post is a walk-through for loading and preprocessing it.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/08/22/Rooting-Android-with-a-Dirty-COW.html">
<h2 class="larger">
Rooting Android with a Dirty COW
</h2>
</a> <br><span class="smaller">August 22, 2021</span> <br/>
<div>
<p>I’ve recently got a quite old Android phone to play with. I guess the first thing to do is getting root, don’t you think?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/08/14/Fresh-Python-Defaults.html">
<h2 class="larger">
Fresh Python Defaults
</h2>
</a> <br><span class="smaller">August 14, 2021</span> <br/>
<div>
<p>When defining a Python function you can define the default value of its parameters.</p>
<p>The defaults are evaluated <em>once</em> and bound to the function’s signature.</p>
<p>That means that <em>mutable</em> defaults are a bad idea: if you modify them in a call, the modification will persist cross calls because for Python its is the same object.</p>
<div class="highlight-candombe"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="p">[]):</span>
<span class="o">...</span>     <span class="n">b</span> <span class="o">+=</span> <span class="s1">&#39;!&#39;</span>
<span class="o">...</span>     <span class="n">c</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="o">...</span>     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;a=</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> b=</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> c=</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># uses the default list</span>
<span class="n">a</span><span class="o">=</span><span class="mi">1</span> <span class="n">b</span><span class="o">=</span><span class="n">x</span><span class="err">!</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># uses the *same* default list</span>
<span class="n">a</span><span class="o">=</span><span class="mi">1</span> <span class="n">b</span><span class="o">=</span><span class="n">x</span><span class="err">!</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="c1"># uses another list</span>
<span class="n">a</span><span class="o">=</span><span class="mi">1</span> <span class="n">b</span><span class="o">=</span><span class="n">z</span><span class="err">!</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># uses the *same* default list, again</span>
<span class="n">a</span><span class="o">=</span><span class="mi">1</span> <span class="n">b</span><span class="o">=</span><span class="n">x</span><span class="err">!</span> <span class="n">c</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</code></pre></div>

<p>A mutable default can be used as the function’s private state as an alternative to functional-traditional <em>closures</em> and object-oriented classes.</p>
<p>But in general a mutable default is most likely to be a bug.</p>
<p>Could Python have a way to prevent such thing? Or better, could Python have a way to <em>restart</em> or <em>refresh</em> the mutable defaults in each call?</p>
<p>This question raised up in the <code class="none">python-list</code>. Let’s see how far we get.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/08/12/Difference-of-Two-Squares.html">
<h2 class="larger">
Difference of two squares
</h2>
</a> <br><span class="smaller">August 12, 2021</span> <br/>
<div>

</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/07/12/SMT-Goals-and-Strategies.html">
<h2 class="larger">
SMT Goals and Strategies
</h2>
</a> <br><span class="smaller">July 12, 2021</span> <br/>
<div>
<p>SMT/SAT problems are in general <em>undecidable</em>: basically we cannot know if we can get even an answer. The <em>search space</em> is in general infinite.</p>
<p>But several concrete problems have a reduced space and <em>may be tractable</em>: while theoretical really hard, we can find a solution in a reasonable time.</p>
<p>Still, a solver may need some extra help to navigate across the search space.</p>
<p>A <em>strategy</em> is a <em>guide</em> that hopefully will lead to a solution (<code>sat</code> or <code>unsat</code>) in a <em>reasonable time</em> using a <em>reasonable amount of resources</em>.</p>
<p>It is quite an art and the concepts were around for more than 30 years.</p>
<p>This post is a quick overview of concepts like <em>strategies</em>, <em>tactics</em>, <em>tacticals</em>, <em>merit order</em>, <em>cost functions</em>, <em>heuristic functions</em>, <em>goals</em>, <em>approximations</em>, <em>redundancy control</em>, <em>search strategies</em>, <em>probes</em> and a few more.</p>
<p>Quite a heavy post I’m afraid.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/07/11/Home-Made-Python-F-String.html">
<h2 class="larger">
Home Made Python F-String
</h2>
</a> <br><span class="smaller">July 11, 2021</span> <br/>
<div>
<p>Python 3.6 introduced the so called <em>f-strings</em>: literal strings that support formatting from the variable in the local context.</p>
<p>Before 3.6 you would to do something like this:</p>
<div class="highlight-candombe"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">11</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">22</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s2">&quot;x=</span><span class="si">{x}</span><span class="s2"> y=</span><span class="si">{y}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
<span class="s1">&#39;x=11 y=22&#39;</span>
</code></pre></div>

<p>But with the f-strings we can remove the bureaucratic call to <code>format</code>:</p>
<div class="highlight-candombe"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="sa">f</span><span class="s2">&quot;x=</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> y=</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="s1">&#39;x=11 y=22&#39;</span>
</code></pre></div>

<p>A few days ago <a href="https://yurichev.com/news/20210707_py_problem/">Yurichev</a> posted: could we achieve a similar feature but without using the f-strings?.</p>
<p>Challenge accepted.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/06/14/Performance-of-ITE-Expressions.html">
<h2 class="larger">
Performance of ITE Expressions (incomplete)
</h2>
</a> <br><span class="smaller">June 14, 2021</span> <br/>
<div>
<p>A <em>branch</em> is an expensive operation even in modern CPUs because the computer will know which of the paths is taken only in the latest stages of the CPU pipeline.</p>
<p>In the meantime, the CPU <em>stalls</em>.</p>
<p>Modern CPUs use branch prediction, speculative execution and instruction reordering to minimize the impact of a branch.</p>
<p>They do a good job but still a <em>branch</em> is potentially expensive so they are replaced by <em>branchless</em> variants.</p>
<p><label for='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL3ozL3BlcmYvbWluLWNoZWNrLWVsYXBzZWQtcGVyLWZ1bmMtaW4tZW5jcnlwdC1leHBlcmltZW50LnN2ZycgLz4KTWluaW11bSAgYGNoZWNrLWVsYXBzZWRgIHRpbWUgKHkgYXhpcykgcGVyIGJyYW5jaC9icmFuY2hsZXNzIGZ1bmN0aW9uICh4IGF4aXMpLgptYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL3ozL3BlcmYvbWluLWNoZWNrLWVsYXBzZWQtcGVyLWZ1bmMtaW4tZW5jcnlwdC1leHBlcmltZW50LnN2ZycgLz4KTWluaW11bSAgYGNoZWNrLWVsYXBzZWRgIHRpbWUgKHkgYXhpcykgcGVyIGJyYW5jaC9icmFuY2hsZXNzIGZ1bmN0aW9uICh4IGF4aXMpLgptYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<img style="width: 100%;" class='fullwidth' alt='' src='/img/z3/perf/min-check-elapsed-per-func-in-encrypt-experiment.svg' />
Minimum <code>check-elapsed</code> time (y axis) per branch/branchless function (x axis).
</span></p>
<p><code>If-Then-Else</code> or ITE for short, are symbolic expression that denotes a value chosen from two possible values based on a condition. These are the <em>symbolic branch</em>.</p>
<p>Naturally we could rewrite a symbolic ITE with a symbolic <em>branchless</em> expression.</p>
<p>The question is: which is better for a solver like Z3? Which makes the SMT/SAT solver faster?</p>
<p>After two weeks working on this post <strong>I still don’t have an answer but at least I know some unknowns.</strong></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/06/12/Document-building-from-static-blog-to-textbook.html">
<h2 class="larger">
Document Building: from static web blogs to textbooks
</h2>
</a> <br><span class="smaller">June 12, 2021</span> <br/>
<div>
<p>I’ve being writing for a long time. I’m far from being a good writer but having the consistency to write at least a blog post every month gave me more expressive power.</p>
<p>Being a non-English native speaker, that also put me in an uncomfortable position –out of the confort zone– but looking back, even with all my mistakes, I really improved.</p>
<p>I’m using a bunch of different technologies to assist me:</p>
<ul>
<li>the <a href="https://book-of-gehn.github.io">blog site</a> is written in <a href="https://guides.github.com/features/mastering-markdown/">Markdown</a> and turned into a static web site with <a href="https://jekyllrb.com/">Jekyll</a>.</li>
<li>the <a href="https://github.com/eldipa/taller-clases/">C/C++ lectures</a> that I give are made with <a href="https://ctan.org/pkg/beamer">Latex/Beamer</a>.</li>
<li>the <a href="https://github.com/eldipa/guia-taller">C/C++ textbook</a> is also in Markdown but it’s compiled into a PDF using <a href="https://pandoc.org/">Pandoc</a> and <a href="https://pypi.org/project/foliant/">Foliant</a>.</li>
</ul>
<p>And while those have been incredible powerful, I hit the limitations of them in time to time.</p>
<p>This writeup is meant to brainstorm and design a new way to work.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/06/05/Seaborn-Cheatsheet.html">
<h2 class="larger">
Seaborn Cheatsheet
</h2>
</a> <br><span class="smaller">June 5, 2021</span> <br/>
<div>
<p>Plotting data was always for me a weak point: it always took me a lot of time to make the plots and graphs, reading the documentation, <em>googling</em> how to do one particular tweak and things like that.</p>
<p>So I challenge myself: could I build a <em>cheatsheet</em> about plotting?</p>
<p>Yes, yes I could.</p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img style="width: 100%;" class='' alt='' src='/img/stats/seaborn-cheatsheet-v1.svg' /></figure></p>
<p><a href="https://seaborn.pydata.org/">Seaborn</a> is a very simple but powerful plotting library on top of <a href="https://matplotlib.org/">matplotlib</a> designed for statistical analysis.</p>
<p>Quick links: <a href="/assets/seaborn-cheatsheet-v1.pdf">PDF (no bg)</a>, <a href="/assets/seaborn-cheatsheet-bg-v1.pdf">PDF (bg)</a>, <a href="/assets/seaborn-cheatsheet-v1.svg">SVG (no bg)</a>, <a href="/assets/seaborn-cheatsheet-bg-v1.svg">SVG (bg)</a> .</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/05/26/Casting-Broadcasting-LUT-and-Bitwise-Ops.html">
<h2 class="larger">
Casting, broadcasting, LUT and bitwise ops
</h2>
</a> <br><span class="smaller">May 26, 2021</span> <br/>
<div>
<p>Z3 has a few basic symbolic operation over bit vectors.</p>
<p>But some others are missing (or at least I couldn’t find them).</p>
<p><em>Cast</em> bit vectors to change the vector width, like when you want to <em>upcast</em> or <em>promote</em> a <code>uint8_t</code> to <code>uint16_t</code>, is one of them.</p>
<p>Arbitrary <em>bitwise operations</em> is another one. Z3 provides the basic <code>And</code>, <code>Or</code> and <code>Xor</code> but arbitrary functions needs to be defined and applied by hand.</p>
<p>And about function definitions, Z3 does not have a simple way to <em>define a function from a lookup table (LUT) or truth table</em>.</p>
<blockquote>
<p><em>A much tricker that I thought!</em></p>
</blockquote>
<p>This post is a kind-of sequel of <a href="/articles/2021/05/17/Verifying-Some-Bithacks.html">Verifying some Bithacks post</a> and prequel of some future posts.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/05/17/Verifying-Some-Bithacks.html">
<h2 class="larger">
Verifying some bithacks
</h2>
</a> <br><span class="smaller">May 17, 2021</span> <br/>
<div>
<p>We are going to verify some of the <a href="https://graphics.stanford.edu/~seander/bithacks.html">bit twiddling hacks</a> made and collected by Sean Eron Anderson and other authors.</p>
<p>This is <em>the</em> classical scenario to put on test your Z3 skills.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/05/09/Solving-a-Murder-Case-with-Z3.html">
<h2 class="larger">
Solving a Murder Case with Z3
</h2>
</a> <br><span class="smaller">May 9, 2021</span> <br/>
<div>
<p>Victor has been murdered!</p>
<p>There are strong evidences that point that Victor was murdered by a single person. The investigation led to three suspects: Art, Bob, and Carl.</p>
<p>But who is the murder?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/05/02/Planning-Space-Missions.html">
<h2 class="larger">
Planning Space Missions with Z3
</h2>
</a> <br><span class="smaller">May 2, 2021</span> <br/>
<div>
<p>A space company is planning the next 4 years. It has several projects, each one with its own budget requirement per year, but the company has a limited budget to invest.</p>
<p>Moreover, some projects <em>depends</em> on others to make them feasible and some projects <em>cannot be done</em> if other projects due unbreakable restrictions.</p>
<div class="table-wrapper">
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Project</th>
<th style="text-align: center;">1st</th>
<th style="text-align: center;">2nd</th>
<th style="text-align: center;">3rd</th>
<th style="text-align: center;">4th</th>
<th style="text-align: left;">Depends</th>
<th style="text-align: left;">Not</th>
<th style="text-align: center;">Profit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1 Cube-1 nano-sat</td>
<td style="text-align: center;">1.1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: center;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">2 Cube-2 nano-sat</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">2.5</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: center;">12</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3 Infrared sat</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4.1</td>
<td style="text-align: left;">on 6</td>
<td style="text-align: left;">with 4</td>
<td style="text-align: center;">18</td>
</tr>
<tr class="even">
<td style="text-align: left;">4 Colored img sat</td>
<td style="text-align: center;"></td>
<td style="text-align: center;"></td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">8</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">with 3</td>
<td style="text-align: center;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5 Mars probe</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">4.4</td>
<td style="text-align: left;">on 1 &amp; 2</td>
<td style="text-align: left;"></td>
<td style="text-align: center;">12</td>
</tr>
<tr class="even">
<td style="text-align: left;">6 Microwave tech</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">2.3</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: center;">1</td>
</tr>
</tbody>
</table>
</div>
<p>Under an incredible amount of assumptions and good luck, what is the best strategy to maximize the profit?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/04/29/Blending-Whisky.html">
<h2 class="larger">
Blending Whisky with Z3
</h2>
</a> <br><span class="smaller">April 29, 2021</span> <br/>
<div>
<p>A whisky producer uses three kind of licor to make their whisky: \(A\), \(B\) and \(C\).</p>
<p>Three kind of whisky can be made using the licor in the following proportions:</p>
<div class="table-wrapper">
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Whisky</th>
<th style="text-align: center;">Sales Price</th>
<th style="text-align: left;">Recipe</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">\(E\)</td>
<td style="text-align: center;">\(680\)</td>
<td style="text-align: left;">No less than 60% of \(A\), no more than 20% of \(C\)</td>
</tr>
<tr class="even">
<td style="text-align: center;">\(F\)</td>
<td style="text-align: center;">\(570\)</td>
<td style="text-align: left;">No less than 15% of \(A\), no more than 80% of \(C\)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">\(G\)</td>
<td style="text-align: center;">\(450\)</td>
<td style="text-align: left;">No more than 50% of \(C\)</td>
</tr>
</tbody>
</table>
</div>
<p>The producer has the following stock and price list from its licor supplier:</p>
<div class="table-wrapper">
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Licor</th>
<th style="text-align: center;">Stock</th>
<th style="text-align: center;">Price</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">\(A\)</td>
<td style="text-align: center;">\(2000\)</td>
<td style="text-align: center;">\(700\)</td>
</tr>
<tr class="even">
<td style="text-align: center;">\(B\)</td>
<td style="text-align: center;">\(2500\)</td>
<td style="text-align: center;">\(500\)</td>
</tr>
<tr class="odd">
<td style="text-align: center;">\(C\)</td>
<td style="text-align: center;">\(1200\)</td>
<td style="text-align: center;">\(400\)</td>
</tr>
</tbody>
</table>
</div>
<p>Note: the prices are in $ per liter and the stock are in liters.</p>
<p>The goal is to maximize the profit.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/04/27/Optimum-Packaging-of-Chocolate.html">
<h2 class="larger">
Optimum Packaging of Chocolate
</h2>
</a> <br><span class="smaller">April 27, 2021</span> <br/>
<div>
<p>A small business sells two types of chocolate packs: A and B.</p>
<p>The pack A has 300 grams of bittersweet chocolate, 500 grams of chocolate with walnuts and 200 grams of white chocolate.</p>
<p>The pack B has 400 grams of bittersweet chocolate, 200 grams of chocolate with walnuts and 400 grams of white chocolate.</p>
<p>The pack A has a price of 120$ while the pack B has a price of 90$.</p>
<p>Let’s assume that this small business has for today 100 kilograms of bittersweet chocolate, 120 kilograms of chocolate with walnuts and 100 kilograms of while chocolate.</p>
<p>How many packs of A and B type should be packed to maximize the profits?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/04/25/Congruence-Closure.html">
<h2 class="larger">
Congruence Closure with Z3
</h2>
</a> <br><span class="smaller">April 25, 2021</span> <br/>
<div>
<p>Assume that you know that \(a = b\), \(b = c\) and \(d = e\). What can you tell me about the claim \(a = c\) ? Is it true or false?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/04/24/Deadly-Typos-2020.html">
<h2 class="larger">
Deadly Typos 2020
</h2>
</a> <br><span class="smaller">April 24, 2021</span> <br/>
<div>
<p>A quick summary of the top 3 <em>typos</em> that I found (or I wrote) in code that they were small but they had a deep impact on the functionality.</p>
<p>In fact, the three bugs could summarized as follows:</p>
<ul>
<li>a missing <code>u</code>.</li>
<li>an extra <code>s</code>.</li>
<li>and a missing <code>*</code>.</li>
</ul>
<p>Do you want to see what is this about?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/03/07/Quiescent-Environment.html">
<h2 class="larger">
Quiescent Environment
</h2>
</a> <br><span class="smaller">March 7, 2021</span> <br/>
<div>
<p>You are working in optimizing a piece of software to reduce the CPU cycles that it takes.</p>
<p>To compare your improvements, it is reasonable to measure the elapsed time before and after your change.</p>
<p>Unless you are using a simulator, it is impossible to run a program <em>isolated</em> from the rest and your measurements will be noisy.</p>
<p>If you want to take precise measurements you need a <em>quiescent</em> environment as much as possible.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/02/27/High-Precision-Timers.html">
<h2 class="larger">
High Precision Timers (userspace)
</h2>
</a> <br><span class="smaller">February 27, 2021</span> <br/>
<div>
<p>You want to measure the time that it takes <code>foo()</code> to run so you do the following:</p>
<div class="highlight-candombe"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">experiment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">begin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">();</span>
<span class="w">    </span><span class="n">foo</span><span class="p">();</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">now</span><span class="p">();</span>

<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Elapsed: %lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">begin</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>

<p>The question is, what <code>now()</code> function you would use?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/02/18/Ksplice-Pointer-Challenge.html">
<h2 class="larger">
Ksplice-Pointer-Challenge
</h2>
</a> <br><span class="smaller">February 18, 2021</span> <br/>
<div>
<p>What does the following code?</p>
<div class="highlight-candombe"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/02/15/Necklaces-Lyndon-Words-and-De-Bruijn-Sequences.html">
<h2 class="larger">
Necklaces, Lyndon words and De Bruijn Sequences
</h2>
</a> <br><span class="smaller">February 15, 2021</span> <br/>
<div>
<p>What have in common a dense arrays for mapping numbers power of 2 to some objects, DNA sequencing and brute-forcing the lock pad of your neighbor?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/02/04/Smashing-ARM-Stack-for-Fun-Part-VII.html">
<h2 class="larger">
Smashing ARM Stack for Fun - Part VII
</h2>
</a> <br><span class="smaller">February 4, 2021</span> <br/>
<div>
<p>It’s time to solve the last challenge of this 7 parts serie.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/26/Smashing-ARM-Stack-for-Fun-Part-VI.html">
<h2 class="larger">
Smashing ARM Stack for Fun - Part VI
</h2>
</a> <br><span class="smaller">January 26, 2021</span> <br/>
<div>
<p>We have the same vulnerability than we have in <a href="/articles/2021/01/14/Smashing-ARM-Stack-for-Fun-Part-V.html">stack4</a> but this time we will make our own egg/shellcode.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/20/Smashing-ARM-Stack-for-Fun-Part-V.html">
<h2 class="larger">
Smashing ARM Stack for Fun - Part V
</h2>
</a> <br><span class="smaller">January 20, 2021</span> <br/>
<div>
<p><a href="https://github.com/azeria-labs/ARM-challenges">Fifth challenge</a> with a small introduction to <em>process continuation</em>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/19/Smashing-ARM-Stack-for-Fun-Part-IV.html">
<h2 class="larger">
Smashing ARM Stack for Fun - Part IV
</h2>
</a> <br><span class="smaller">January 19, 2021</span> <br/>
<div>
<p>This time the goal is to make the program print the message <code><span class="highlight-candombe-inline"><span class="s">&quot;code flow successfully changed&quot;</span></span></code>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/18/Smashing-ARM-Stack-for-Fun-Part-III.html">
<h2 class="larger">
Smashing ARM Stack for Fun - Part III
</h2>
</a> <br><span class="smaller">January 18, 2021</span> <br/>
<div>
<p>Another fast moving post about exploiting the <a href="https://github.com/azeria-labs/ARM-challenges">third Arm challenge</a></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/17/Smashing-ARM-Stack-for-Fun-Part-II.html">
<h2 class="larger">
Smashing ARM Stack for Fun - Part II
</h2>
</a> <br><span class="smaller">January 17, 2021</span> <br/>
<div>
<p>This is going to be a fast moving post, directly to the details, about exploiting the <a href="https://github.com/azeria-labs/ARM-challenges">second Arm challenge</a></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/14/Smashing-ARM-Stack-for-Fun-Part-I.html">
<h2 class="larger">
Smashing ARM Stack for Fun - Part I
</h2>
</a> <br><span class="smaller">January 14, 2021</span> <br/>
<div>
<p>This is the first of a serie of posts about exploiting 32 bits Arm binaries.</p>
<p>These <a href="https://github.com/azeria-labs/ARM-challenges">challenges</a> were <a href="https://azeria-labs.com/part-3-stack-overflow-challenges/">taken</a> from <a href="https://azeria-labs.com">Azeria Labs</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/09/Interactive-Assembler.html">
<h2 class="larger">
iasm: Interactive Assembler
</h2>
</a> <br><span class="smaller">January 9, 2021</span> <br/>
<div>
<p>I crossed with a series of <a href="https://github.com/azeria-labs/ARM-challenges">Arm challenges</a> by causality and I decided to give it a shoot.</p>
<p>But I have <strong>0</strong> knowledge about Arm so the disassembly of the binaries were too strange for me.</p>
<p>I stepped back to plan it better: my idea was to use GDB to debug small snippets of Arm code, learn about it before jumping into the challenges.</p>
<p>I setup a <a href="/articles/2020/12/15/Qemulating-Rasbian-ARM.html">QEMU virtual machine</a> running Rasbian in an Arm CPU.</p>
<p>With a GCC and GDB running there I started but the compile-load-debug cycle was too inflexible.</p>
<p>I could not use it to <em>explore</em>.</p>
<p>If I wanted to see the effect of a particular instruction I needed to write it in assembly, compile it and debug it.</p>
<p>And the time between the “what does X?” and the “X does this” was too large, reducing the <em>momentum</em> that you have when you explore something new.</p>
<p>Too tedious.</p>
<p>So I decided to shorten the cycle writing an <a href="https://github.com/bad-address/iasm"><em>interactive</em> assembler</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2021/01/04/Review-Arm-Assembly.html">
<h2 class="larger">
Review Arm Assembly
</h2>
</a> <br><span class="smaller">January 4, 2021</span> <br/>
<div>
<p>There is no other way to learn something that playing with it.</p>
<p>Take assembly code, read it and predice what will do. Then test it.</p>
<p>Those mistakes, those mismatches between what you think and what it really is, those <em>surprises</em> are what move us forward into learning. Deeper.</p>
<p>In this post I will dig into Arm, assisted with an <a href="https://github.com/bad-address/iasm">interactive assembler</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/12/27/TLDR-Quick-Overview-of-Arm.html">
<h2 class="larger">
TL;DR Quick Overview of Arm
</h2>
</a> <br><span class="smaller">December 27, 2020</span> <br/>
<div>
<p>Speed-reading of <a href="https://www.coranac.com/tonc/text/asm.htm">Whirlwind Tour of ARM Assembly</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/12/15/Qemulating-Rasbian-ARM.html">
<h2 class="larger">
QEMUlating a Rasbian (ARM)
</h2>
</a> <br><span class="smaller">December 15, 2020</span> <br/>
<div>
<p>Quick how-to download and run a Raspbian Buster (ARM) emulating the vm with QEMU.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/12/05/Self-Licensing.html">
<h2 class="larger">
Self-Licensing
</h2>
</a> <br><span class="smaller">December 5, 2020</span> <br/>
<div>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img style="max_width: 60%;" class='' alt='' src='/img/sociology/self-licensing-small.png' /></figure></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/11/29/RC-on-XDP-RX-Queue.html">
<h2 class="larger">
RC-on-XDP-RX-Queue
</h2>
</a> <br><span class="smaller">November 29, 2020</span> <br/>
<div>
<p><label for='PGltZyBzdHlsZT0ibWF4X3dpZHRoOiAxMjAlOyIgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9kZWJ1Zy94ZHAtcngtcmMvcngtcmMtcXVldWVzLnBuZycgLz5tYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0ibWF4X3dpZHRoOiAxMjAlOyIgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9kZWJ1Zy94ZHAtcngtcmMvcngtcmMtcXVldWVzLnBuZycgLz5tYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<img style="max_width: 120%;" class='fullwidth' alt='' src='/img/debug/xdp-rx-rc/rx-rc-queues.png' />
</span></p>
<p>Picture this: you’d been developing for six months a network sniffer using XDP, a kernel <em>in-pass</em> in Linux.</p>
<p>Six months and when you are about to release it, you find not one but three bugs that shake all your understanding of XDP.</p>
<p>A debugging race against the clock begins.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/11/19/Qubes-Networking.html">
<h2 class="larger">
Qubes OS Networking
</h2>
</a> <br><span class="smaller">November 19, 2020</span> <br/>
<div>
<p><a href="https://www.qubes-os.org/">Qubes OS</a> has an interesting network system to isolate more-or-less trusted <em>application</em> virtual machines (App) from absolute untrusted <em>network</em> VMs (Net).</p>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9uZXR3b3JrL3F1YmVzL3F1YmVzLWlwcy5wbmcnIC8+bWFyZ2lu' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9uZXR3b3JrL3F1YmVzL3F1YmVzLWlwcy5wbmcnIC8+bWFyZ2lu' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/network/qubes/qubes-ips.png' />
</span></p>
<p>These last ones have the drivers required to handle ethernet and wifi cards which expose them to a potentially deathly bug lurking in the drivers.</p>
<p>An additional VM is put in the middle between App VMs and Net VMs. This absolute trusted <em>proxy</em> VM serves as a safe firewall (Proxy).</p>
<p>In this post will explore how these VMs connect and how the packets are forwarded up and down along this chain of VMs.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/11/12/TLDR-Stylometrics.html">
<h2 class="larger">
TL;DR Stylometrics
</h2>
</a> <br><span class="smaller">November 12, 2020</span> <br/>
<div>
<p>A ghost writer is a person that writes a document, essay or paper but the work is presented by other person who <em>claims</em> to be the author.</p>
<p><a href="https://thebestschools.org/resources/detecting-deterring-ghostwritten-papers-best-practices/">Detecting deterring ghostwritten papers</a> is an article written by a (ex)ghost writer and explains what happens behind the scene when a student pays for this <em>dark</em> service.</p>
<p>Would be possible to detect this in an automated way?</p>
<p>Given a set of documents, could we determine of they were written or not by the person or people who claim to be the authors?</p>
<p>This problem is known as <em>authorship attribution</em> and I will show a few papers that I read about this, in particular around the concept of <em>stylometric</em>, fingerprints that the real author leaves when he or she writes.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/10/11/Kasiski-Test-Part-I.html">
<h2 class="larger">
Kasiski Test - Part I
</h2>
</a> <br><span class="smaller">October 11, 2020</span> <br/>
<div>
<p>The tricky part of breaking the <a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenere cipher</a> consists in finding the length of the key.</p>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9jcnlwdG8va2FzaXNraS9rYXNpc2tpX3NjYW5fcG9zaXRpb25zLnBuZycgLz5tYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9jcnlwdG8va2FzaXNraS9rYXNpc2tpX3NjYW5fcG9zaXRpb25zLnBuZycgLz5tYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/crypto/kasiski/kasiski_scan_positions.png' />
</span></p>
<p>We discussed this in the <a href="/articles/2018/05/01/Breaking-Vigenere.html">breaking Vigenere</a> post.</p>
<p>In that occasion we used the <a href="https://en.wikipedia.org/wiki/Hamming_distance">Hamming distance</a> and the <a href="/articles/2019/10/04/Index-of-Coincidence.html">Index of Coincidence</a>.</p>
<p>But another method existed much before the development of the IC around 1922.</p>
<p>In 1863, Kasiski published a method to guess the length of the secret key, method that we know today as the <a href="https://en.wikipedia.org/wiki/Kasiski_examination">Kasiski test</a>.</p>
<p>Let’s explore a \(O(\vert s \vert)\) solution with a worst case of \(O(\vert s \vert^2)\)</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/09/13/Debug-the-Case-of-a-CPU-Burning-Ruby-Process.html">
<h2 class="larger">
Debug: the Case of a CPU Burning Ruby Process
</h2>
</a> <br><span class="smaller">September 13, 2020</span> <br/>
<div>
<p><code>executor.rb</code> is a little program that starts and finishes other programs based on the needs of the system.</p>
<p>It is expected to have one and only one <code>executor.rb</code> process running with little overhead.</p>
<p>In one of the machines in the lab I found the opposite: two <code>executor.rb</code> instances and one of them running at top speed, consuming 100% of CPU.</p>
<p>For the rest, the system was working properly so one of the <code>executor.rb</code> was doing its job.</p>
<p>But what was the <em>“twin evil”</em> process doing with the CPU?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/09/09/Reds-and-Blues-Architecture.html">
<h2 class="larger">
Reds and Blues Architecture
</h2>
</a> <br><span class="smaller">September 9, 2020</span> <br/>
<div>
<p><label for='PGltZyBzdHlsZT0ibWF4X3dpZHRoOiAxMDAlOyIgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9kZXNpZ24vcmVkLWJsdWUtYXJjaC9yZWRzLWFuZC1ibHVlcy1vcmlnaW5hbC5wbmcnIC8+Ck9yaWdpbmFsIGRlc2lnbjogYSBsaXR0bGUgbWVzc3kgd2l0aCBJTyBtaXhlZCB3aXRoIENQVSBib3VuZGVkIGNvZGUuCm1hcmdpbg==' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0ibWF4X3dpZHRoOiAxMDAlOyIgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9kZXNpZ24vcmVkLWJsdWUtYXJjaC9yZWRzLWFuZC1ibHVlcy1vcmlnaW5hbC5wbmcnIC8+Ck9yaWdpbmFsIGRlc2lnbjogYSBsaXR0bGUgbWVzc3kgd2l0aCBJTyBtaXhlZCB3aXRoIENQVSBib3VuZGVkIGNvZGUuCm1hcmdpbg==' class='margin-toggle'/>
<span class='marginnote'>
<img style="max_width: 100%;" class='fullwidth' alt='' src='/img/design/red-blue-arch/reds-and-blues-original.png' />
Original design: a little messy with IO mixed with CPU bounded code.
</span></p>
<p>Could we design an architecture that allows us to have insight about the performance of the system?</p>
<p>When you spend nights debugging searching where is the bottleneck, it is when you blame the you of the past for a so <em>opaque</em> and slow architecture.</p>
<p>This is the proposal of a simple architecture that allows introspection and enables – too many times forgotten – basic optimizations.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/05/16/Debugging-Lock-Free-Algorithms.html">
<h2 class="larger">
Debugging Lock Free Algorithms
</h2>
</a> <br><span class="smaller">May 16, 2020</span> <br/>
<div>
<p>Debugging multithread code is hard and lock free algorithms is harder.</p>
<p>What cleaver tricks can we use?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/04/28/Lock-Free-Queue-Part-II.html">
<h2 class="larger">
Lock Free Queue - Part II
</h2>
</a> <br><span class="smaller">April 28, 2020</span> <br/>
<div>
<p>If implementing a lock-free queue for only one producer and consumer is tricky, adding more producers and consumers moves this to the next level.</p>
<p>This is the continuation of the <a href="/articles/2020/03/22/Lock-Free-Queue-Part-I.html">lock-free single-producer single-consumer queue</a></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/04/19/Sidenote-Identifiers.html">
<h2 class="larger">
Sidenote: Identifiers
</h2>
</a> <br><span class="smaller">April 19, 2020</span> <br/>
<div>
<p>What would be a nice identifier for the people in, let’s say, a database?</p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img style="max_width: 40%;" class='' alt='' src='/img/misc/ids/email.png' /></figure></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/03/22/Lock-Free-Queue-Part-I.html">
<h2 class="larger">
Lock-Free Queue - Part I
</h2>
</a> <br><span class="smaller">March 22, 2020</span> <br/>
<div>
<p>While implementing a bounded queue or <em>ring buffer</em> in a single-thread universe is relatively easy, doing the same when you have two threads, the implementation of a lock-free queue is <em>more challenging</em>.</p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img  class='' alt='' src='/img/threading/lock-free/queue/queue-sp-sc.png' /></figure></p>
<p>In this first part will analyse and implement a lock-free single-producer single-consumer queue. A multi-producer multi-consumer queue is described in the <a href="/articles/2020/04/28/Lock-Free-Queue-Part-II.html">second part</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/02/15/CPU-Cache-Coherence.html">
<h2 class="larger">
Effects of CPU Cache Coherence
</h2>
</a> <br><span class="smaller">February 15, 2020</span> <br/>
<div>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy90aHJlYWRpbmcvY2FjaGUtY29oZXJlbmNlL2NudC1jcHUtMm5kY3B1LWhlYXRtYXAucG5nJyAvPm1hcmdpbg==' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy90aHJlYWRpbmcvY2FjaGUtY29oZXJlbmNlL2NudC1jcHUtMm5kY3B1LWhlYXRtYXAucG5nJyAvPm1hcmdpbg==' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/threading/cache-coherence/cnt-cpu-2ndcpu-heatmap.png' />
</span></p>
<p>Most modern cpus see a single <em>shared</em> main memory seeing the same thing, <em>eventually</em>.</p>
<p>This post explores what is behind this <em>“eventually”</em> term.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2020/02/07/Compiler-Optimizations-under-RC.html">
<h2 class="larger">
Compiler Optimizations under a Race Condition
</h2>
</a> <br><span class="smaller">February 7, 2020</span> <br/>
<div>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy90aHJlYWRpbmcvb3B0aW1pemF0aW9uLXVuZGVyLXJjL3JjTzAtYnVzeS1sb29wLnBuZycgLz5tYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy90aHJlYWRpbmcvb3B0aW1pemF0aW9uLXVuZGVyLXJjL3JjTzAtYnVzeS1sb29wLnBuZycgLz5tYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/threading/optimization-under-rc/rcO0-busy-loop.png' />
</span></p>
<p>When two or more concurrent tasks perform non-atomic read/write operations over the same data we have a <em>race condition</em> and the system will be in an undefined state.</p>
<p>But what exactly does that suppose to mean? What is behind the generic <em>undefined state</em>?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/10/27/Writeup-EKO2019-RPG-Part-I-Reversing.html">
<h2 class="larger">
RPG - Part I (IDA writeup - EKO 2019)
</h2>
</a> <br><span class="smaller">October 27, 2019</span> <br/>
<div>
<p><code>rpg</code> is a buggy game where the player can attack to and defend from attacks of monsters.</p>
<p>Let’s see if we can know how it works.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/10/23/Constant-Rate-Loop.html">
<h2 class="larger">
Constant Rate Loop
</h2>
</a> <br><span class="smaller">October 23, 2019</span> <br/>
<div>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9nYW1lL2NvbnN0YW50LXJhdGUtbG9vcC9iaXRlLmdpZicgLz4KU2FtZSBhbmltYXRpb24gdGhhdCBsYXN0IDEgc2Vjb25kIGluIGEgbG9vcC4gRnJvbSB0b3AgdG8gZG93biwgdGhlIGZpcnN0CmlzIGFuIGFuaW1hdGlvbiB3aXRob3V0IGFueSBmcmFtZSBsb3N0LCB0aGUgc2Vjb25kIGhhZCBsb3N0IHNvbWUgZnJhbWVzCmJ1dCBgYGRyYXcoKWBgIGlzIHN0aWxsIGluIHN5bmMsIHRoZSBsYXN0IG9uZSBsb3N0IHRoZSBzYW1lIGFtb3VudApvZiBmcmFtZXMgYnV0IGBgZHJhdygpYGAgdXNlZCBpdHMgb3duIG5vdGlvbiBvZiB0aW1lIGFuIGdvdCBvdXQgb2Ygc3luYy4KIFs8aSBjbGFzcz0iZmFiIGZhLWdpdGh1YiI+PC9pPiBjb2RlXSgvYXNzZXRzL2Ryb3BfaXRlcmF0aW9ucy5weSkKIG1hcmdpbg==' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9nYW1lL2NvbnN0YW50LXJhdGUtbG9vcC9iaXRlLmdpZicgLz4KU2FtZSBhbmltYXRpb24gdGhhdCBsYXN0IDEgc2Vjb25kIGluIGEgbG9vcC4gRnJvbSB0b3AgdG8gZG93biwgdGhlIGZpcnN0CmlzIGFuIGFuaW1hdGlvbiB3aXRob3V0IGFueSBmcmFtZSBsb3N0LCB0aGUgc2Vjb25kIGhhZCBsb3N0IHNvbWUgZnJhbWVzCmJ1dCBgYGRyYXcoKWBgIGlzIHN0aWxsIGluIHN5bmMsIHRoZSBsYXN0IG9uZSBsb3N0IHRoZSBzYW1lIGFtb3VudApvZiBmcmFtZXMgYnV0IGBgZHJhdygpYGAgdXNlZCBpdHMgb3duIG5vdGlvbiBvZiB0aW1lIGFuIGdvdCBvdXQgb2Ygc3luYy4KIFs8aSBjbGFzcz0iZmFiIGZhLWdpdGh1YiI+PC9pPiBjb2RlXSgvYXNzZXRzL2Ryb3BfaXRlcmF0aW9ucy5weSkKIG1hcmdpbg==' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/game/constant-rate-loop/bite.gif' />
Same animation that last 1 second in a loop. From top to down, the first is an animation without any frame lost, the second had lost some frames but <code>draw()</code> is still in sync, the last one lost the same amount of frames but <code>draw()</code> used its own notion of time an got out of sync. <a href="/assets/drop_iterations.py"><i class="fab fa-github"></i> code</a>
</span></p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img  class='' alt='' src='/img/game/constant-rate-loop/rest-nodrop.png' /></figure></p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img  class='' alt='' src='/img/game/constant-rate-loop/rest-drop.png' /></figure></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/10/04/Index-of-Coincidence.html">
<h2 class="larger">
Index of Coincidence Explained
</h2>
</a> <br><span class="smaller">October 4, 2019</span> <br/>
<div>
<p>The concept of Index of Coincidence was introduced by William Friedman in 1922-1923 in the paper titled “The Index of Coincidence and its Applications in Cryptoanalysis” [<a href="/assets/biblio/index_of_coincidence_1923.pdf">1</a>].</p>
<p>The Navy Department (US) worked in the following years on this topic coming, in 1955, with a paper titled “The Index of Coincidence” by Howard Campaigne [<a href="/assets/biblio/index_of_coincidence_1955.pdf">2</a>].</p>
<p>However I found some confusing and misleading concepts in the <em>modern</em> literature.</p>
<p>This post is a summary of what I could understand from Howard’s work.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/10/01/Writeup-EKO2019-Cipherchat.html">
<h2 class="larger">
Cipherchat (Crypto writeup - EKO 2019)
</h2>
</a> <br><span class="smaller">October 1, 2019</span> <br/>
<div>
<p>We start with a <a href="/assets/cipherchat.pcap">communication</a> between two machines, encrypted with an unknown algorithm and the challenge is to break it.</p>
<p>As a <em>hint</em> we have the code that the client used to talk with the server.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/09/29/Writeup-EKO2019-Weirdo.html">
<h2 class="larger">
Weirdo (SQLi writeup - EKO 2019)
</h2>
</a> <br><span class="smaller">September 29, 2019</span> <br/>
<div>
<p>Quick writeup of a SQL injection challenge.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/08/22/CTR-Bitfliping.html">
<h2 class="larger">
CTR Bitflipping
</h2>
</a> <br><span class="smaller">August 22, 2019</span> <br/>
<div>
<p>No much to explain: encryption <strong>does not</strong> offer any protection against forgery.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>We saw this in the <a href="/articles/2018/07/03/CBC-Bitflipping.html">CBC Bitflipping post</a> and we will see it again here but this time it will be the CTR encryption mode our victim.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/08/04/Better-Compression-Log-Files-PoC.html">
<h2 class="larger">
Better Compression of Log Files (PoC)
</h2>
</a> <br><span class="smaller">August 4, 2019</span> <br/>
<div>
<p>The logs present several patterns that are repeated again and again; LZMA takes advantage of that and reaches very high compress ratios.</p>
<p>Doing a quick test, LZMA at the 6 level of compression, compressed a 2.5 GB log into 147 MB very tight binary blog. A ratio of 94.069%, not bad!</p>
<p>But could we get better results?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/07/25/From-Regex-to-Nondeterministic-Finite-Automata.html">
<h2 class="larger">
From a Regex to a Nondeterministic Finite Automata
</h2>
</a> <br><span class="smaller">July 25, 2019</span> <br/>
<div>
<p>Before building complex state machine we need to learn the basics blocks.</p>
<p>When the solution to a problem can be seen as set of states with transitions from ones to others, modeling them as a nondeterministic finite automatas makes clear how the solution works and allows to spot deficiencies.</p>
<p>A regular expression is an example of this. As an introductory step let’s review how to turn a regex into a NFA.</p>
<p>Take at look of the <a href="https://github.com/eldipa/nfa">source code in Github</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/05/08/CTR-Edit-Inject-Plaintext-Attacks.html">
<h2 class="larger">
CTR Edit/Inject Plaintext Attacks
</h2>
</a> <br><span class="smaller">May 8, 2019</span> <br/>
<div>
<p>A CTR-mode cipher turns a block cipher into a stream cipher.</p>
<p>With this, a ciphertext can be edited <em>in place</em> generating enough of the key stream, decrypting and re-encrypting the edited portion.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>One can replace part of the plaintext, extend it or even reduce it.</p>
<p>But this beautiful property of a CTR mode (and any other stream cipher) is actually a booby-trap.</p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img style="width: 80%;" class='' alt='' src='/img/matasano/ctr-edit-slicing-window.svg' /></figure></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/03/20/Affine-Ciphers.html">
<h2 class="larger">
Affine Cipher
</h2>
</a> <br><span class="smaller">March 20, 2019</span> <br/>
<div>
<p>A <em>linear</em> cipher like the Hill Cipher is <a href="/articles/2019/01/02/Break-Hill-Cipher-with-a-Known-Plaintext-Attack.html">vulnerable</a> to a known plaintext attack: just resolve a set of linear equations and get the secret key.</p>
<p>An <em>affine</em> cipher is a little harder to break, however it could be vulnerable to a <em>differential</em> attack.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/03/15/Separate-your-SSH-Agent-Identities.html">
<h2 class="larger">
Separate your SSH Agent Identities
</h2>
</a> <br><span class="smaller">March 15, 2019</span> <br/>
<div>
<p>Using a <code>ssh-agent</code> to handle our keys is handy.</p>
<p>When you need to access to different hosts jumping from one to another, <em>forwarding</em> the agent is much more secure than copying and pasting your keys around.</p>
<p>But if one host gets compromised it will expose your agent: even if the attacker will not get your secret keys he will be able to login into any system as you.</p>
<p>You cannot prevent this, but you can restrict this to reduce the splash damage.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/02/03/Cape-Encryption.html">
<h2 class="larger">
Cape Encryption
</h2>
</a> <br><span class="smaller">February 3, 2019</span> <br/>
<div>
<p><label for='CltjYXBlJ3Mgc2l0ZV0oaHR0cHM6Ly9naXRodWIuY29tL2dpb2JsdS9DYXBlL3RyZWUvMjk0ZjgxMGFjNDgzMWFmMjY4MzJlNzBlNGJhNWQwNzM5MDgyMzJlMikKbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='CltjYXBlJ3Mgc2l0ZV0oaHR0cHM6Ly9naXRodWIuY29tL2dpb2JsdS9DYXBlL3RyZWUvMjk0ZjgxMGFjNDgzMWFmMjY4MzJlNzBlNGJhNWQwNzM5MDgyMzJlMikKbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<a href="https://github.com/gioblu/Cape/tree/294f810ac4831af26832e70e4ba5d073908232e2">cape’s site</a>
</span></p>
<p>The Cape library offers a symmetric stream cipher implemented in <code>cape_decrypt</code> and <code>cape_encrypt</code>.</p>
<p><label for='CmBgY2FwZV9oYXNoYGAgaXMgYW4gdW5mb3J0dW5hdGVseSBuYW1lIGZvciBhIGNpcGhlci4KbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='CmBgY2FwZV9oYXNoYGAgaXMgYW4gdW5mb3J0dW5hdGVseSBuYW1lIGZvciBhIGNpcGhlci4KbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<code>cape_hash</code> is an unfortunately name for a cipher.
</span></p>
<p>In addition, it offers another symmetric stream cipher, a slightly different of the first one, implemented in <code>cape_hash</code>.</p>
<p>In this write-up we are going to analyze the <code>cape_hash</code> stream cipher and see if we can break it.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2019/01/02/Break-Hill-Cipher-with-a-Known-Plaintext-Attack.html">
<h2 class="larger">
Break Hill Cipher with a Known Plaintext Attack
</h2>
</a> <br><span class="smaller">January 2, 2019</span> <br/>
<div>
<p>Given a matrix secret key \(K\) with shape \(n\textrm{x}n\), the <a href="https://en.wikipedia.org/wiki/Hill_cipher">Hill cipher</a> splits the plaintext into blocks of length \(n\) and for each block, computes the ciphertext block doing a linear transformation in module \(m\)</p>
$$ K p_i = c_i\quad(\textrm{mod } m)$$
<p>For decrypting, we apply the inverse of \(K\)</p>
$$ p_i = [K]^{-1} c_i \quad(\textrm{mod } m)$$
<p>To make sense, the secret key \(K\) must be chosen such as its inverse exists in module \(m\).</p>
<p>Ready to break it?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/12/23/Mersenne-Twister-PRNG.html">
<h2 class="larger">
Breaking MT19937 Crypto
</h2>
</a> <br><span class="smaller">December 23, 2018</span> <br/>
<div>
<p>The Mersenne-Twister 19937 or just MT19937 is one of the most used pseudo random number generator with a quite large cycle length and with a nice random quality.</p>
<p>However it was not designed to be used for crypto.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>But some folks may not know this…</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/12/04/Fixed-Nonce-CTR-Attack.html">
<h2 class="larger">
Fixed Nonce CTR Attack
</h2>
</a> <br><span class="smaller">December 4, 2018</span> <br/>
<div>
<p>The Counter mode, or just CTR mode, turns a block cipher into a stream cipher.</p>
<p>More specifically, it builds a pseudo random generator (PRG) from a block cipher and then generates a random string using the PRG to encrypt/decrypt the payload performing a simple xor.</p>
<p>The idea is to initialize the PRG with a different <em>seed</em> each time but if this does not happen, all the plaintexts will be encrypted with the <em>same</em> pseudo random key stream – totally insecure.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>Ready to break it?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/10/28/CBC-Padding-Oracle.html">
<h2 class="larger">
CBC Padding Oracle Attack
</h2>
</a> <br><span class="smaller">October 28, 2018</span> <br/>
<div>
<p>AES and other ciphers work on blocks; if the plaintext length is not multiple of the block size a padding is added.</p>
<p>If during the decryption the pad is checked and returns an error, we can use this to build a <em>padding oracle</em>: a function that will tell us if an encrypted plaintext has a valid pad or not.</p>
<p>It may not sound too much exiting but armed with this <em>padding oracle</em> we can <strong>break CBC</strong> one byte at time.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>Ready? <em>Go!</em></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/10/01/Magic-Bash-Runes.html">
<h2 class="larger">
() { Magic Bash Runes
</h2>
</a> <br><span class="smaller">October 1, 2018</span> <br/>
<div>
<p>Despite of been 4 years old, <code>Shellshock</code> is still a very interesting topic to me not for the vulnerability itself but for the large ways to trigger it even in the most unexpected places.</p>
<p>Take the 4 characters <code>() {</code> and open the world.</p>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9iYXNoL3NoZWxsc2hvY2svcnVuZXMucG5nJyAvPgpGcmFnbWVudHMgZm91bmQgaW4gdGhlIGZpZWxkLgptYXJnaW4=' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9iYXNoL3NoZWxsc2hvY2svcnVuZXMucG5nJyAvPgpGcmFnbWVudHMgZm91bmQgaW4gdGhlIGZpZWxkLgptYXJnaW4=' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/bash/shellshock/runes.png' />
Fragments found in the field.
</span></p>
<p>Creativity and few hours reading man pages are all what you need.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/09/16/Ouroboros-Circular-Buffer.html">
<h2 class="larger">
Ouroboros - Circular Buffer
</h2>
</a> <br><span class="smaller">September 16, 2018</span> <br/>
<div>
<p><code>struct circular_buffer</code> is a simple but quite efficient implementation of a circular buffer over a continuous and finite memory slice.</p>
<p>The name <a href="https://en.wikipedia.org/wiki/Ouroboros">Ouroboros</a> comes from the Ancient Greek and symbolize a snake eating its own tail – a convenient image for a circular buffer.</p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img  class='' alt='' src='/img/queues/circular-buffer/buffer_0_10.png' /></figure></p>
<p>Source code can be found in the <a href="https://github.com/eldipa/tiburoncin">tiburoncin project</a>. Enjoy it!</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/07/03/CBC-Bitflipping.html">
<h2 class="larger">
CBC Bitflipping
</h2>
</a> <br><span class="smaller">July 3, 2018</span> <br/>
<div>
<p><label for='PGltZyBzdHlsZT0ibWF4X3dpZHRoOiA2MCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL21hdGFzYW5vL2NiYy1kZWMucG5nJyAvPm1hcmdpbg==' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0ibWF4X3dpZHRoOiA2MCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL21hdGFzYW5vL2NiYy1kZWMucG5nJyAvPm1hcmdpbg==' class='margin-toggle'/>
<span class='marginnote'>
<img style="max_width: 60%;" class='fullwidth' alt='' src='/img/matasano/cbc-dec.png' />
</span></p>
<p>CBC does not offer any protection against an active attacker.</p>
<p>Flipping some bits in a ciphertext block totally scrambles its plaintext but it has a very specific effect in the <em>next</em> plaintext block.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>Without any message integrity, a CBC ciphertext can be patched to modify the plaintext at will.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/07/01/Cut-and-Paste-ECB-Blocks.html">
<h2 class="larger">
Cut and Paste ECB blocks
</h2>
</a> <br><span class="smaller">July 1, 2018</span> <br/>
<div>
<p>In this game we control partially a plaintext that is encrypted under ECB mode with a secret key.</p>
<p>This time the idea is not to reveal the key but to <em>forge</em> a plaintext.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>Welcome to the <a href="https://cryptopals.com/sets/2/challenges/13">ECB cut-and-paste</a> challenge!</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/06/10/Breaking-ECB.html">
<h2 class="larger">
Breaking ECB
</h2>
</a> <br><span class="smaller">June 10, 2018</span> <br/>
<div>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>In the previous post we built <a href="/articles/2018/06/09/ECB-CBC-Oracle.html">an ECB/CBC oracle</a>; now it’s time to take this to the next level and break ECB <a href="https://cryptopals.com/sets/2/challenges/14">one byte at time</a>.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/06/09/ECB-CBC-Oracle.html">
<h2 class="larger">
ECB/CBC Oracle
</h2>
</a> <br><span class="smaller">June 9, 2018</span> <br/>
<div>
<p>In this post will review the Cipher Block Chaining mode (or CBC) and how we can build <a href="https://cryptopals.com/sets/2/challenges/11">an ECB/CBC detection oracle</a> to distinguish ECB from CBC using <a href="https://pypi.org/project/cryptonita/">cryptonita</a></p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img style="width: 70%;" class='' alt='' src='/img/matasano/ecb_cbc_prefix_aligned.svg' /></figure></p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>This will be the bases for <a href="/articles/2018/06/10/Breaking-ECB.html">breaking ECB</a> in a later post.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/05/20/Detecting-Penguins.html">
<h2 class="larger">
Detecting Penguins
</h2>
</a> <br><span class="smaller">May 20, 2018</span> <br/>
<div>
<p><figure><figcaption><span markdown='1'>
The ECB encrypted image on the right and its plaintext original version on the left. Image taken from <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">wikipedia</a>.
</span></figcaption>
<img  class='' alt='' src='/img/matasano/tux.png' /></figure></p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>Can you see the penguin?</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/05/01/Breaking-Vigenere.html">
<h2 class="larger">
Breaking Vigenere
</h2>
</a> <br><span class="smaller">May 1, 2018</span> <br/>
<div>
<p>A plaintext was encrypted via a XOR with key of unknown bytes of length, repeating this key as much as needed to cover the full length of the plaintext.</p>
<p>This is also known as the <a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenere cipher</a>.</p>
<p>It is 101 cipher, which it is easy to break in theory, but it has more than one challenge hidden to be resolve in the practice.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>Shall we?</p>
<p><figure><figcaption><span markdown='1'>
</span></figcaption>
<img style="width: 100%;" class='' alt='' src='/img/matasano/break_repeat_key_transpose.svg' /></figure></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/04/01/A-string-of-coincidences-is-not-a-coincidence.html">
<h2 class="larger">
A string of coincidences is not a coincidence
</h2>
</a> <br><span class="smaller">April 1, 2018</span> <br/>
<div>
<p>A cipher is <em>semantically secure</em> if given a randomly chosen key, its ciphertext cannot be distinguishable from a truly random string.</p>
<p>Detecting a ciphertext from a pool is enough to consider the cipher as not secure even of we can’t break it.</p>
<p>In the following pool of random strings one is actually a ciphertext that is the <code>xor</code> encryption of a plaintext using a single-byte key.</p>
<div class="highlight-candombe"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">cryptonita</span> <span class="kn">import</span> <span class="n">B</span><span class="p">,</span> <span class="n">load_bytes</span>     <span class="c1"># byexample: +timeout=10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ciphertexts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">load_bytes</span><span class="p">(</span><span class="s1">&#39;./posts/matasano/assets/4.txt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="mi">16</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">methods</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>

<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>This is obviously a poor and not secure encryption mechanism; let’s find the ciphertext then!</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2018/03/01/In-XOR-We-Trust.html">
<h2 class="larger">
In XOR we trust
</h2>
</a> <br><span class="smaller">March 1, 2018</span> <br/>
<div>
<p>This is the first set of exercises for the <a href="https://cryptopals.com/">Matasano Challenge</a> (also known as the Cryptopals Challenge)</p>
<p>It starts from the very begin, really easy, but it goes up to more challenging exercises quickly.</p>
<p><label for='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'> &#8853;</label>
<input type='checkbox' id='KiotLSBTcG9pbGVyIEFsZXJ0ISAtLSoqbWFyZ2lubm90ZXM=' class='margin-toggle'/>
<span class='marginnote'>
<strong>– Spoiler Alert! –</strong>
</span></p>
<p>Ready? <em>Go!</em></p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2017/04/16/Isolate-wifi-and-keep-traffic-out-Big-Brother-sight.html">
<h2 class="larger">
Isolate a wifi card and keep your traffic out of the Big Brother sight
</h2>
</a> <br><span class="smaller">April 16, 2017</span> <br/>
<div>
<p><label for='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9uZXR3b3JrL2lzb2xhdGVfd2lmaV9iaWdfYnJvdGhlcl9zaWdodC5wbmcnIC8+bWFyZ2lu' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyAgY2xhc3M9J2Z1bGx3aWR0aCcgYWx0PScnIHNyYz0nL2ltZy9uZXR3b3JrL2lzb2xhdGVfd2lmaV9iaWdfYnJvdGhlcl9zaWdodC5wbmcnIC8+bWFyZ2lu' class='margin-toggle'/>
<span class='marginnote'>
<img  class='fullwidth' alt='' src='/img/network/isolate_wifi_big_brother_sight.png' />
</span></p>
<p>HTTP Proxies blacklisting evil domains, firewalls blocking weird traffic and IDSs looking for someone that shouldn’t be there are reasonable and understandable policies for a corporate environment.</p>
<p>But when a friend opened his browser this week and went to <code>google.com</code> the things got odd.</p>
<p>The browser refused the connection warning him that the SSL certificate of the server wasn’t issue by <code>google.com</code> at all or signed by a trusted authority.</p>
</div>
<p></span></p>
<span class="index-single-post">
<hr class="slender post-layout">
<a href="https://book-of-gehn.github.io/articles/2016/12/18/Forensics-911-recovering-thesis.html">
<h2 class="larger">
Forensics 911 - recovering a thesis of one year work
</h2>
</a> <br><span class="smaller">December 18, 2016</span> <br/>
<div>
<p><label for='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL2ZvcmVuc2ljcy90aGVzaXMtcmVjb3ZlcmluZy90cmltbWluZ19zY3JhcGluZ19kZHJlc2N1ZS5zdmcnIC8+bWFyZ2lu' class='margin-toggle'>&#8853;</label>
<input type='checkbox' id='PGltZyBzdHlsZT0id2lkdGg6IDEwMCU7IiBjbGFzcz0nZnVsbHdpZHRoJyBhbHQ9Jycgc3JjPScvaW1nL2ZvcmVuc2ljcy90aGVzaXMtcmVjb3ZlcmluZy90cmltbWluZ19zY3JhcGluZ19kZHJlc2N1ZS5zdmcnIC8+bWFyZ2lu' class='margin-toggle'/>
<span class='marginnote'>
<img style="width: 100%;" class='fullwidth' alt='' src='/img/forensics/thesis-recovering/trimming_scraping_ddrescue.svg' />
</span></p>
<p>A friend of mine called me: a girl friend of him was hopeless trying to recover her thesis from a corrupted usb stick <em>three days</em> before her presentation.</p>
<p>She was working in her thesis for almost a year, saving all the progresses in that usb stick. But what she didn’t know was that an usb memory has a limited number of writes and with more writes eventually the file system gets corrupted.</p>
<p>This is the real story behind a forensics rally trying to recover her one year work.</p>
</div>
<p></span></p>
</article>
<span class="print-footer"> - Martin Di Paola</span>
<footer>
    <hr class="slender">
    <div class="credits">
        <span>&copy;
            Martin Di Paola
        </span></br>
            <a class="raw_link" href="/atom.xml"><img height="16px" width="16px" src="/img/rss-32px.png" /></a>
            <a class="raw_link" href="https://github.com/eldipa"><img height="16px" width="16px" src="/img/github.png" /></a>
        <br>
        
        <a href="mailto:martinp.dipaola@gmail.com">martinp.dipaola@gmail.com</a></span></br> <br>
        
    </div>

    <img src='http://192.34.63.156:6127/img/http%3A//127.0.0.1%3A4000/pages/index.html.png' async></img>
</footer>
</body>
</html>
