import{marked}from"marked";const DEFAULT_SLIDE_SEPARATOR="\r?\n---\r?\n",DEFAULT_VERTICAL_SEPARATOR=null,DEFAULT_NOTES_SEPARATOR="^s*notes?:",DEFAULT_ELEMENT_ATTRIBUTES_SEPARATOR="\\.element\\s*?(.+?)$",DEFAULT_SLIDE_ATTRIBUTES_SEPARATOR="\\.slide:\\s*?(\\S.+?)$",SCRIPT_END_PLACEHOLDER="__SCRIPT_END__",CODE_LINE_NUMBER_REGEX=/\[\s*((\d*):)?\s*([\s\d,|-]*)\]/,HTML_ESCAPE_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Plugin=()=>{let n;function a(t){let e=(t.querySelector("[data-template]")||t.querySelector("script")||t).textContent;var t=(e=e.replace(new RegExp(SCRIPT_END_PLACEHOLDER,"g"),"<\/script>")).match(/^\n?(\s*)/)[1].length,r=e.match(/^\n?(\t*)/)[1].length;return 0<r?e=e.replace(new RegExp("\\n?\\t{"+r+"}(.*)","g"),function(t,e){return"\n"+e}):1<t&&(e=e.replace(new RegExp("\\n? {"+t+"}(.*)","g"),function(t,e){return"\n"+e})),e}function s(t){var r=t.attributes,a=[];for(let t=0,e=r.length;t<e;t++){var n=r[t].name,o=r[t].value;/data\-(markdown|separator|vertical|notes)/gi.test(n)||a.push(o?n+'="'+o+'"':n)}return a.join(" ")}function c(t){var e=n?.getConfig?.().markdown;return(t=t||{}).separator=t.separator||e?.separator||DEFAULT_SLIDE_SEPARATOR,t.verticalSeparator=t.verticalSeparator||e?.verticalSeparator||DEFAULT_VERTICAL_SEPARATOR,t.notesSeparator=t.notesSeparator||e?.notesSeparator||DEFAULT_NOTES_SEPARATOR,t.attributes=t.attributes||"",t}function E(t,e){e=c(e);e=t.split(new RegExp(e.notesSeparator,"mgi"));return'<script type="text/template">'+(t=(t=2===e.length?e[0]+'<aside class="notes">'+marked(e[1].trim())+"</aside>":t).replace(/<\/script>/g,SCRIPT_END_PLACEHOLDER))+"<\/script>"}function i(t,r){r=c(r);var e=new RegExp(r.separator+(r.verticalSeparator?"|"+r.verticalSeparator:""),"mg"),a=new RegExp(r.separator);let n,o=0,s,i=!0,l,d=[];for(;n=e.exec(t);)!(s=a.test(n[0]))&&i&&d.push([]),l=t.substring(o,n.index),(s&&i?d:d[d.length-1]).push(l),o=e.lastIndex,i=s;(i?d:d[d.length-1]).push(t.substring(o));let u="";for(let t=0,e=d.length;t<e;t++)d[t]instanceof Array?(u+="<section "+r.attributes+">",d[t].forEach(function(t){u+="<section data-markdown>"+E(t,r)+"</section>"}),u+="</section>"):u+="<section "+r.attributes+" data-markdown>"+E(d[t],r)+"</section>";return u}function o(r){return new Promise(function(t){const e=[];[].slice.call(r.querySelectorAll("section[data-markdown]:not([data-markdown-parsed])")).forEach(function(r,t){var o;r.getAttribute("data-markdown").length?e.push((o=r,new Promise(function(r,a){const e=new XMLHttpRequest,n=o.getAttribute("data-markdown");var t=o.getAttribute("data-charset");null!==t&&""!==t&&e.overrideMimeType("text/html; charset="+t),e.onreadystatechange=function(t,e){4===e.readyState&&(200<=e.status&&e.status<300||0===e.status?r:a)(e,n)}.bind(this,o,e),e.open("GET",n,!0);try{e.send()}catch(t){console.warn("Failed to get the Markdown file "+n+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+t),r(e,n)}}).then(function(t,e){r.outerHTML=i(t.responseText,{separator:r.getAttribute("data-separator"),verticalSeparator:r.getAttribute("data-separator-vertical"),notesSeparator:r.getAttribute("data-separator-notes"),attributes:s(r)})},function(t,e){r.outerHTML='<section data-state="alert">ERROR: The attempt to fetch '+e+" failed with HTTP status "+t.status+".Check your browser's JavaScript console for more details.<p>Remember that you need to serve the presentation HTML from a HTTP server.</p></section>"}))):r.outerHTML=i(a(r),{separator:r.getAttribute("data-separator"),verticalSeparator:r.getAttribute("data-separator-vertical"),notesSeparator:r.getAttribute("data-separator-notes"),attributes:s(r)})}),Promise.all(e).then(t)})}function u(t,e,r){var a,n,r=new RegExp(r,"mg"),o=new RegExp('([^"= ]+?)="([^"]+?)"|(data-[^"= ]+?)(?=[" ])',"mg");let s=t.nodeValue;if(a=r.exec(s)){var i=a[1];for(s=s.substring(0,a.index)+s.substring(r.lastIndex),t.nodeValue=s;n=o.exec(i);)n[2]?e.setAttribute(n[1],n[2]):e.setAttribute(n[3],"");return!0}return!1}function l(){var t=n.getRevealElement().querySelectorAll("[data-markdown]:not([data-markdown-parsed])");return[].slice.call(t).forEach(function(t){t.setAttribute("data-markdown-parsed",!0);var e=t.querySelector("aside.notes"),r=a(t);t.innerHTML=marked(r),function a(n,o,t,s,i){if(null!==o&&void 0!==o.childNodes&&0<o.childNodes.length){let r=o;for(let e=0;e<o.childNodes.length;e++){var l=o.childNodes[e];if(0<e){let t=e-1;for(;0<=t;){var d=o.childNodes[t];if("function"==typeof d.setAttribute&&"BR"!==d.tagName){r=d;break}--t}}let t=n;"section"===l.nodeName&&(t=l,r=l),"function"!=typeof l.setAttribute&&l.nodeType!==Node.COMMENT_NODE||a(t,l,r,s,i)}}o.nodeType===Node.COMMENT_NODE&&!1===u(o,t,s)&&u(o,n,i)}(t,t,null,t.getAttribute("data-element-attributes")||t.parentNode.getAttribute("data-element-attributes")||DEFAULT_ELEMENT_ATTRIBUTES_SEPARATOR,t.getAttribute("data-attributes")||t.parentNode.getAttribute("data-attributes")||DEFAULT_SLIDE_ATTRIBUTES_SEPARATOR),e&&t.appendChild(e)}),Promise.resolve()}return{id:"markdown",init:function(t){let{renderer:e,animateLists:r,...a}=(n=t).getConfig().markdown||{};return e||((e=new marked.Renderer).code=(t,e)=>{let r="",a="";var n;return CODE_LINE_NUMBER_REGEX.test(e)&&((n=e.match(CODE_LINE_NUMBER_REGEX)[2])&&(r=`data-ln-start-from="${n.trim()}"`),a=`data-line-numbers="${a=e.match(CODE_LINE_NUMBER_REGEX)[3].trim()}"`,e=e.replace(CODE_LINE_NUMBER_REGEX,"").trim()),t=t.replace(/([&<>'"])/g,t=>HTML_ESCAPE_MAP[t]),`<pre><code ${a} ${r} class="${e}">${t}</code></pre>`}),!0===r&&(e.listitem=t=>`<li class="fragment">${t}</li>`),marked.setOptions({renderer:e,...a}),o(n.getRevealElement()).then(l)},processSlides:o,convertSlides:l,slidify:i,marked:marked}};export default Plugin;